<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adding Landscape Explanatory Variables to 'SSN' Objects Directly in R Using StreamCatTools • SSN2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Adding Landscape Explanatory Variables to 'SSN' Objects Directly in R Using StreamCatTools">
<meta property="og:description" content="SSN2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SSN2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">An Introduction to Spatial Stream Network Modeling in R Using SSN2</a>
    </li>
    <li>
      <a href="../articles/StreamCatTools.html">Adding Landscape Explanatory Variables to 'SSN' Objects Directly in R Using StreamCatTools</a>
    </li>
    <li>
      <a href="../articles/LargeData.html">Fitting Spatial Stream Network Models to Large Data Sets and Making Predictions (i.e., Kriging)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USEPA/SSN2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adding Landscape Explanatory Variables to ‘SSN’
Objects Directly in R Using StreamCatTools</h1>
                        <h4 data-toc-skip class="author">Michael
Dumelle, Marc Weber, and Ryan Hill</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/SSN2/blob/HEAD/vignettes/articles/StreamCatTools.Rmd" class="external-link"><code>vignettes/articles/StreamCatTools.Rmd</code></a></small>
      <div class="hidden name"><code>StreamCatTools.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Landscape explanatory variables can be added directly to
<code>SSN</code> objects using the <code>StreamCatTools</code>
<strong>R</strong> package. <code>StreamCatTools</code> interacts with
StreamCat <span class="citation">(Hill et al. 2016)</span>,a database of
hundreds of metrics for approximately 2.65 million stream segments in
the conterminous United States (CONUS). StreamCat metrics exist at
catchment and watershed scales and represent natural and anthropogenic
landscape variables. StreamCat is built on the medium resolution
National Hydrogrpahy Dataset Plus (version 2.1). To learn more about
StreamCat, visit their website at <a href="https://www.epa.gov/national-aquatic-resource-surveys/streamcat-dataset" class="external-link">this
link</a>. In this vignette, will show how to use
<code>StreamCatTools</code> to access StreamCat data; for more detail
regarding <code>StreamCatTools</code>, visit their website at <a href="https://usepa.github.io/StreamCatTools/" class="external-link">this link</a>.</p>
<p>Before proceeding, we load the <code>SSN2</code>,
<code>StreamCatTools</code>, and <code>ggplot2</code> <strong>R</strong>
packages (which can all be installed directly from CRAN) by running:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/">SSN2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/StreamCatTools/" class="external-link">StreamCatTools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-bugs-data">The <code>bugs</code> Data<a class="anchor" aria-label="anchor" href="#the-bugs-data"></a>
</h2>
<p>The <code>bugs</code> data is an SSN object that contains
macroinvertebrate data in the Lower Snake Basin. It can be downloaded
via GitHub at <a href="https://github.com/USEPA/SSN2/tree/develop/vignettes/articles" class="external-link">this
link</a>. We read in <code>bugs</code> by running:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_import.html">ssn_import</a></span><span class="op">(</span><span class="st">"bugs.ssn"</span>, predpts <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span></code></pre></div>
<p>There are 549 observed sites and 300 prediction sites:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bugs</span></span>
<span><span class="co">#&gt; Object of class SSN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object includes observations on 13 variables across 549 sites within the bounding box</span></span>
<span><span class="co">#&gt;     xmin     ymin     xmax     ymax </span></span>
<span><span class="co">#&gt; -1765346  2459843 -1343175  2909567 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object also includes 1 set of prediction points with 300 locations</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable names are (found using ssn_names(object)):</span></span>
<span><span class="co">#&gt; $obs</span></span>
<span><span class="co">#&gt;  [1] "comid"     "ELEV_DEM"  "AREAWTMAP" "Rich"      "rid"       "ratio"    </span></span>
<span><span class="co">#&gt;  [7] "upDist"    "afvArea"   "locID"     "netID"     "pid"       "geometry" </span></span>
<span><span class="co">#&gt; [13] "netgeom"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pred</span></span>
<span><span class="co">#&gt;  [1] "comid"     "ELEV_DEM"  "AREAWTMAP" "rid"       "ratio"     "upDist"   </span></span>
<span><span class="co">#&gt;  [7] "afvArea"   "locID"     "netID"     "pid"       "geom"      "netgeom"</span></span></code></pre></div>
<p>We visualize the flowlines (edges), observed macroinvertebrate
richness (obs), and prediction sites (preds) by running:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Rich</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="StreamCatTools_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We create the hydrologic distance matrices required for fitting SSN
models by running:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssn_create_distmat.html">ssn_create_distmat</a></span><span class="op">(</span><span class="va">bugs</span>, predpts <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-explanatory-variables-to-an-ssn-object">Adding Explanatory Variables to an <code>SSN</code> Object<a class="anchor" aria-label="anchor" href="#adding-explanatory-variables-to-an-ssn-object"></a>
</h2>
<p>Any of the hundreds of StreamCat metrics can be added to observed and
prediction sites through NHD’s common identifier, or COMID. The COMID is
a 10 digit code that uniquely identifies an NHD feature. The
<code>bugs</code> data has <code>COMID</code>s available for each
observed and prediction site. StreamCat metrics can be searched at <a href="https://www.epa.gov/national-aquatic-resource-surveys/streamcat-metrics-and-definitions" class="external-link">this
link</a> or within <code>StreamCatTools</code>, which we discuss
later.</p>
<p>In StreamCat, the <code>"tmean8110"</code> metric contains 30-year
mean annual temperature between 1981 and 2010, and the
<code>pctconif2008</code> contains the proportion of evergreen forest
land cover in 2008 (based on the National Landcover Dataset, or NLCD;
see <a href="https://www.usgs.gov/centers/eros/science/national-land-cover-database" class="external-link">this
link</a> for more). StreamCat metrics are defined with respect to an
“Area of Interest”, or AOI. Typically these are “cat” (for local
catchment) or “ws” (for full upstream watershed). Additional AOIs exist
for catchments and watersheds restricted to 100 meter riparian buffer.
The <code><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_data.html" class="external-link">sc_get_data()</a></code> function in <code>StreamCatTools</code>
returns metrics in the AOI based on COMID:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmean8110"</span>, <span class="st">"pctconif2008"</span><span class="op">)</span></span>
<span><span class="va">sc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_data.html" class="external-link">sc_get_data</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="va">sc_vars</span>,</span>
<span>  aoi <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  comid <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">comid</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sc_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      comid pctconif2008cat tmean8110cat</span></span>
<span><span class="co">#&gt; 1 23428382           85.10     7.663872</span></span>
<span><span class="co">#&gt; 2 23428446           93.14     6.605735</span></span>
<span><span class="co">#&gt; 3 23428578           94.49     6.685206</span></span>
<span><span class="co">#&gt; 4 23428848           94.16     6.353155</span></span>
<span><span class="co">#&gt; 5 23428858           90.34     6.584575</span></span>
<span><span class="co">#&gt; 6 23428892           99.89     4.959707</span></span></code></pre></div>
<p><code>sc_data</code> is a data frame with column <code>comid</code>,
column <code>pctconif2008cat</code> (for <code>pctconif2008</code> in
the catchment AOI), and column <code>tmean8110cat</code> (for
<code>tmean8110cat</code>). These metrics are merged to
<code>bugs$obs</code> via <code>"comid"</code> by running:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="va">sc_data</span>, by <span class="op">=</span> <span class="st">"comid"</span><span class="op">)</span></span></code></pre></div>
<p>We visualize these new metrics spatially by running:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">pctconif2008cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">tmean8110cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="StreamCatTools_files/figure-html/unnamed-chunk-9-1.png" width="49%"><img src="StreamCatTools_files/figure-html/unnamed-chunk-9-2.png" width="49%"></p>
<p>Similarly, these metrics can be added to the prediction sites:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_pred_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_data.html" class="external-link">sc_get_data</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="va">sc_vars</span>,</span>
<span>  aoi <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  comid <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span><span class="op">$</span><span class="va">comid</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, <span class="va">sc_pred_data</span>, by <span class="op">=</span> <span class="st">"comid"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-an-ssn-model">Fitting an SSN Model<a class="anchor" aria-label="anchor" href="#fitting-an-ssn-model"></a>
</h2>
<p>We fit an SSN model describing species richness (the number of unique
species) as a function of site elevation, 30-year mean annual
temperature, and the percentage of the catchment with evergreen forest
cover by running:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Rich</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">tmean8110cat</span> <span class="op">+</span> <span class="va">pctconif2008cat</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">bugs</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Rich ~ ELEV_DEM + tmean8110cat + pctconif2008cat, </span></span>
<span><span class="co">#&gt;     ssn.object = bugs, tailup_type = "exponential", taildown_type = "exponential", </span></span>
<span><span class="co">#&gt;     additive = "afvArea")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -34.939  -4.916   2.135   7.168  23.143 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;                  Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)     58.222785   8.610861   6.762 1.37e-11 ***</span></span>
<span><span class="co">#&gt; ELEV_DEM        -0.010409   0.003305  -3.150  0.00163 ** </span></span>
<span><span class="co">#&gt; tmean8110cat    -1.442592   0.760347  -1.897  0.05779 .  </span></span>
<span><span class="co">#&gt; pctconif2008cat  0.027568   0.016689   1.652  0.09857 .  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pseudo R-squared: 0.03298</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;                 Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;     tailup exponential  de (parsill)       2.97</span></span>
<span><span class="co">#&gt;     tailup exponential         range  593762.56</span></span>
<span><span class="co">#&gt;   taildown exponential  de (parsill)      25.82</span></span>
<span><span class="co">#&gt;   taildown exponential         range   47730.45</span></span>
<span><span class="co">#&gt;                 nugget        nugget      60.30</span></span></code></pre></div>
<p>Here, we modeled the spatial covariance using both a tailup
exponential structure and a taildown exponential structure (we omitted a
Euclidean structure). Based on the fitted model, there is strong
evidence that increasing elevation is associated decreasing richness, on
average (<span class="math inline">\(p\)</span>-value &lt; 0.01), some
evidence that increasing temperature is associated with decreasing
richness, on average (<span class="math inline">\(p\)</span>-value <span class="math inline">\(\approx\)</span> 0.06), and some evidence that
increasing percent evergreen forest cover is associated with increasing
richness, on average (<span class="math inline">\(p\)</span>-value <span class="math inline">\(\approx\)</span> 0.10).</p>
</div>
<div class="section level2">
<h2 id="prediction-kriging">Prediction (Kriging)<a class="anchor" aria-label="anchor" href="#prediction-kriging"></a>
</h2>
<p>We augment the prediction sites with predictions by running:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span></code></pre></div>
<p>We visualize these predictions alongside the observed richness by
running:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aug_preds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Rich</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, name <span class="op">=</span> <span class="st">"Rich"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="StreamCatTools_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We use block Kriging to predict the average species richness in the
Lower Snake Basin alongside a prediction interval by running:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred"</span>, block <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="co">#&gt;        fit     lwr      upr</span></span>
<span><span class="co">#&gt; 1 37.64725 36.0336 39.26091</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-streamcattools-features">Other <code>StreamCatTools</code> Features<a class="anchor" aria-label="anchor" href="#other-streamcattools-features"></a>
</h2>
<p>There are several other <code>StreamCatTools</code> features which
simplify the process of interacting with StreamCat. The
<code><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_params.html" class="external-link">sc_get_params()</a></code> function returns parameters available using
the StreamCat API. For example, we can learn details like AOI, category,
units, and other metadata information for each metric by running:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_params.html" class="external-link">sc_get_params</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"variable_info"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">var_info</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 13</span></span></span>
<span><span class="co">#&gt;   category     metric aoi   year  short_description long_description units  dsid</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Anthropogen… NABD_… Cat,… <span style="color: #BB0000;">NA</span>    NABD Dam Density  Density of geor… Coun…    33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Anthropogen… NABD_… Cat,… <span style="color: #BB0000;">NA</span>    NABD NID Reservo… Volume all rese… Cubi…    33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Anthropogen… NABD_… Cat,… <span style="color: #BB0000;">NA</span>    NABD Normal Rese… Volume all rese… Cubi…    33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Natural      Preci… Cat,… <span style="color: #BB0000;">NA</span>    Surplus Precipit… This dataset re… Kilo…    75</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Soils        Rckde… Cat,… <span style="color: #BB0000;">NA</span>    Mean Bedrock Dep… Mean depth (cm)… Cent…    56</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Soils        agkff… Cat,… <span style="color: #BB0000;">NA</span>    Ag Soil Erodibil… Mean of STATSGO… Unit…    28</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: dataset &lt;chr&gt;, source_name &lt;chr&gt;, source_URL &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ACTIVE &lt;dbl&gt;, DSNAME &lt;chr&gt;</span></span></span></code></pre></div>
<p>You can search for specific metrics that satisfy certain conditions
using <code><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_metric_names.html" class="external-link">sc_get_metric_names()</a></code>. For example, we can find all
the climate variables measured at catchment and watershed scales by
running:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_metric_names.html" class="external-link">sc_get_metric_names</a></span><span class="op">(</span>category <span class="op">=</span> <span class="st">"Climate"</span>, aoi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cat"</span>, <span class="st">"Ws"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 9</span></span></span>
<span><span class="co">#&gt;    Category Metric        AOI   Year  Short_Name Metric_Description Units Source</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Climate  bfi[AOI]      Cat,… <span style="color: #BB0000;">NA</span>    Base Flow… Base flow is the … Perc… USGS …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Climate  precip8110[A… Cat,… <span style="color: #BB0000;">NA</span>    30-year M… PRISM climate dat… Mill… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Climate  precip9120[A… Cat,… 1991… 30-year M… PRISM climate dat… Mill… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Climate  precip[Year]… Cat,… 2008… Mean Prec… PRISM climate dat… Mill… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Climate  tmax8110[AOI] Cat,… 1981… 30-year A… PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Climate  tmax9120[AOI] Cat,… 1991… 30-year A… PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Climate  tmean8110[AO… Cat,… 1981… 30-year M… PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Climate  tmean9120[AO… Cat,… 1991… 30-year M… PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Climate  tmean[Year][… Cat,… 2008… Mean Air … PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Climate  tmin8110[AOI] Cat,… 1981… 30-year A… PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Climate  tmin9120[AOI] Cat,… 1991… 30-year A… PRISM climate dat… Cels… PRISM </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: Dataset &lt;chr&gt;</span></span></span></code></pre></div>
<p>If we only have access to x- and y-coordinates (instead of COMIDs),
we can use <code><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_comid.html" class="external-link">sc_get_comid()</a></code> to find the NHD feature that
contains a coordinate by running:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sct_comid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_comid.html" class="external-link">sc_get_comid</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></code></pre></div>
<p>The COMIDs are stored in a single comma-separated vector (this is how
StreamCat interacts its API). This vector can be separated into distinct
COMIDs for more direct use with <strong>R</strong> by running</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sct_comid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">sct_comid</span>, <span class="st">","</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The COMIDs stored in <code>bugs$obs</code> match the COMIDs we
accessed via <code><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_comid.html" class="external-link">sc_get_comid()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_comid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  bugs_comid <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">comid</span>,</span>
<span>  sct_comid <span class="op">=</span> <span class="va">sct_comid</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_comid</span><span class="op">)</span></span>
<span><span class="co">#&gt;   bugs_comid sct_comid</span></span>
<span><span class="co">#&gt; 1   23428382  23428382</span></span>
<span><span class="co">#&gt; 2   23428382  23428382</span></span>
<span><span class="co">#&gt; 3   23428446  23428446</span></span>
<span><span class="co">#&gt; 4   23428578  23428578</span></span>
<span><span class="co">#&gt; 5   23428848  23428848</span></span>
<span><span class="co">#&gt; 6   23428858  23428858</span></span></code></pre></div>
<p>Here, we have only briefly explored the potential for
<code>SSN2</code> integration with <code>StreamCatTools</code>; to learn
more about <code>StreamCatTools</code>, visit their website at <a href="https://usepa.github.io/StreamCatTools/" class="external-link">this link</a>.</p>
</div>
<div class="section level2">
<h2 id="alternatives-to-streamcat">Alternatives to StreamCat<a class="anchor" aria-label="anchor" href="#alternatives-to-streamcat"></a>
</h2>
<p>Several other landscape data sources exist for stream networks
outside of CONUS. In Canada, there is the Canadian Hydrospatial Network
(<a href="https://natural-resources.canada.ca/science-data/data-analysis/geospatial-data-tools-services/canadian-hydrospatial-network" class="external-link">this
link</a>). In Europe, there is EU-Hydro (<a href="https://www.eea.europa.eu/data-and-maps/data/external/eu-hydro-2013-river-network.0-1" class="external-link">this
link</a>). In Australia, there is Geofabric (<a href="https://www.bom.gov.au/water/geofabric/" class="external-link">this link</a>). Worldwide
there is HydroAtlas (<a href="https://www.hydrosheds.org/hydroatlas" class="external-link">this link</a>), though
HydroAtlas data tends to be coarser than more localized data sets.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="r-code-appendix">R Code Appendix<a class="anchor" aria-label="anchor" href="#r-code-appendix"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"#&gt;"</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  warning <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/">SSN2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/StreamCatTools/" class="external-link">StreamCatTools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">bugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_import.html">ssn_import</a></span><span class="op">(</span><span class="st">"bugs.ssn"</span>, predpts <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="va">bugs</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Rich</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ssn_create_distmat.html">ssn_create_distmat</a></span><span class="op">(</span><span class="va">bugs</span>, predpts <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="va">sc_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmean8110"</span>, <span class="st">"pctconif2008"</span><span class="op">)</span></span>
<span><span class="va">sc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_data.html" class="external-link">sc_get_data</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="va">sc_vars</span>,</span>
<span>  aoi <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  comid <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">comid</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sc_data</span><span class="op">)</span></span>
<span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="va">sc_data</span>, by <span class="op">=</span> <span class="st">"comid"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">pctconif2008cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">tmean8110cat</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">sc_pred_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_data.html" class="external-link">sc_get_data</a></span><span class="op">(</span></span>
<span>  metric <span class="op">=</span> <span class="va">sc_vars</span>,</span>
<span>  aoi <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  comid <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span><span class="op">$</span><span class="va">comid</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, <span class="va">sc_pred_data</span>, by <span class="op">=</span> <span class="st">"comid"</span><span class="op">)</span></span>
<span><span class="va">ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Rich</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">tmean8110cat</span> <span class="op">+</span> <span class="va">pctconif2008cat</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">bugs</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="va">aug_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aug_preds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Rich</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, name <span class="op">=</span> <span class="st">"Rich"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred"</span>, block <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">var_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_params.html" class="external-link">sc_get_params</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"variable_info"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">var_info</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_metric_names.html" class="external-link">sc_get_metric_names</a></span><span class="op">(</span>category <span class="op">=</span> <span class="st">"Climate"</span>, aoi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cat"</span>, <span class="st">"Ws"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sct_comid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/StreamCatTools/reference/sc_get_comid.html" class="external-link">sc_get_comid</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span>
<span><span class="va">sct_comid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">sct_comid</span>, <span class="st">","</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dat_comid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  bugs_comid <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">comid</span>,</span>
<span>  sct_comid <span class="op">=</span> <span class="va">sct_comid</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat_comid</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-hill2016stream" class="csl-entry">
Hill, Ryan A, Marc H Weber, Scott G Leibowitz, Anthony R Olsen, and
Darren J Thornbrugh. 2016. <span>“The Stream-Catchment (StreamCat)
Dataset: A Database of Watershed Metrics for the Conterminous United
States.”</span> <em>JAWRA Journal of the American Water Resources
Association</em> 52 (1): 120–28.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Dumelle, Jay M. Ver Hoef, Erin Peterson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
