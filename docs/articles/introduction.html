<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An Introduction to Spatial Stream Network Modeling in R Using SSN2 • SSN2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to Spatial Stream Network Modeling in R Using SSN2">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SSN2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">An Introduction to Spatial Stream Network Modeling in R Using SSN2</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/USEPA/SSN2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An Introduction to Spatial Stream Network Modeling in R Using SSN2</h1>
                        <h4 data-toc-skip class="author">Michael
Dumelle, Erin Peterson, Jay M. Ver Hoef, Alan Pearse, and Dan Isaak</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/SSN2/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Data from streams frequently exhibit unique patterns of spatial
autocorrelation resulting from the branching network structure,
longitudinal (i.e., upstream/downstream) connectivity, directional water
flow, and differences in flow volume throughout the network <span class="citation">(Erin E. Peterson et al. 2013)</span>. In addition,
stream networks are embedded within a spatial environment, which can
also influence observations on the stream network. Traditional spatial
statistical models, which are based solely on Euclidean distance, often
fail to adequately describe these unique and complex spatial
dependencies.</p>
<p>Spatial stream network models are based on a moving-average
construction <span class="citation">(J. M. Ver Hoef and Peterson
2010)</span> and are specifically designed to describe two unique
spatial relationships found in streams data. A pair of sites is
considered flow-connected when water flows from an upstream site to a
downstream site. Sites are flow-unconnected when they reside on the same
stream network (i.e., share a common junction downstream) but do not
share flow.</p>
<p>Spatial stream network models typically rely on two families of
covariance functions to represent these relationships: the tail-up and
tail-down models. In a tail-up model, the moving-average function points
in the upstream direction. Covariance is a function of stream distance
and a weighting structure used to proportionally allocate, or split, the
function at upstream junctions to account for differences in flow volume
or other influential variables <span class="citation">(Erin E. Peterson
and Ver Hoef 2010)</span>. As a result, non-zero covariances are
restricted to flow-connected sites in a tail-up model. In a tail-down
model, the moving average function points in the downstream direction.
In contrast to the tail-up model, tail-down models allow for both
flow-connected and flow-unconnected autocorrelation, autocorrelation
will always be equal or stronger for flow-unconnected sites than
flow-connected sites separated by equal stream distances <span class="citation">(J. M. Ver Hoef and Peterson 2010)</span>. In the
tail-down model, covariance is a function of stream distance and weights
are not required. However, it is also possible and often preferable to
build spatial stream network models based on a mixture of four
components: a tail-up component, a tail-down component, a Euclidean
component, and a nugget component. The Euclidean component is useful
because it captures covariance in influential processes that are
independent of the stream network at intermediate and broad scales
(e.g., air temperature, soil type, or geology). The nugget component
captures covariance in processes that are highly localized, thus being
independent across sites. For more details regarding the construction of
spatial stream network models and their covariance components, see <span class="citation">Cressie et al. (2006)</span>, <span class="citation">J.
M. Ver Hoef, Peterson, and Theobald (2006)</span>, <span class="citation">J. M. Ver Hoef and Peterson (2010)</span>, <span class="citation">Erin E. Peterson and Ver Hoef (2010)</span>, and <span class="citation">Isaak et al. (2014)</span>.</p>
<p>The <code>SSN2</code> <strong>R</strong> package is used to fit and
summarize spatial stream network models and make predictions at
unobserved locations (Kriging). <code>SSN2</code> is an updated version
of the <code>SSN</code> <strong>R</strong> package <span class="citation">(J. Ver Hoef et al. 2014)</span>. Why did we create
<code>SSN2</code> to replace the <code>SSN</code> <strong>R</strong>
package? There are two main reasons:</p>
<ol style="list-style-type: decimal">
<li>
<p>The <code>SSN</code> <strong>R</strong> package depends on the
<code>rgdal</code> <span class="citation">(Bivand, Keitt, and Rowlingson
2021)</span>, <code>rgeos</code> <span class="citation">(Bivand and
Rundel 2020)</span>, and <code>maptools</code> <span class="citation">(Bivand and Lewin-Koh 2021)</span> <strong>R</strong>
packages, which were retired in October, 2023. Their functionality has
been replaced and modernized by the <code>sf</code> package <span class="citation">(Pebesma 2018)</span>. <code>SSN2</code> depends on
<code>sf</code> instead of <code>rgdal</code>, <code>rgeos</code>, and
<code>maptools</code>, reflecting this broader change regarding handling
spatial data in <strong>R</strong>.</p>
<ul>
<li>See <span class="citation">Nowosad (2023)</span> for more
information regarding the retirement of <code>rgdal</code>,
<code>rgeos</code>, and <code>maptools</code>, available at <a href="https://geocompx.org//post/2023/rgdal-retirement" class="external-link">this
link</a>.</li>
</ul>
</li>
<li><p>There are features added to <code>SSN2</code> that would have
been difficult to implement in the <code>SSN</code> <strong>R</strong>
package without a massive restructuring of its foundation, so a new
package was created. For example, the <code>SSN</code> objects in
<code>SSN2</code> are S3 objects but the <code>SSN</code> objects in the
<code>SSN</code> <strong>R</strong> package were S4 objects.
Additionally, many functions were rewritten and/or repurposed in
<code>SSN2</code> to use generic functions (e.g., block prediction in
<code>SSN2</code> is performed using <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> while in the
<code>SSN</code> <strong>R</strong> package it was performed using
<code>BlockPredict()</code>). Moreover, <code>SSN2</code> leverages many
of the tools in the <code>spmodel</code> <strong>R</strong> package for
spatial statistical modeling <span class="citation">(Dumelle, Higham,
and Ver Hoef 2023)</span>.</p></li>
</ol>
<p>This vignette provides an overview of basic features in
<code>SSN2</code>. We load <code>SSN2</code> by running</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/" class="external-link">SSN2</a></span><span class="op">)</span></span></code></pre></div>
<p>If you use <code>SSN2</code> in a formal publication or report,
please cite it. Citing <code>SSN2</code> lets us devote more resources
to it in the future. We view the <code>SSN2</code> citation by
running</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"SSN2"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; To cite SSN2 in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Dumelle M, Peterson, E, Ver Hoef JM, Pearse A, Isaak D (2023). SSN2:</span></span>
<span><span class="co">#&gt;   Spatial Modeling on Stream Networks in R. R package version 0.2.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Manual{,</span></span>
<span><span class="co">#&gt;     title = {{SSN2}: Spatial Modeling on Stream Networks in {R}},</span></span>
<span><span class="co">#&gt;     author = {Michael Dumelle and Erin Peterson and Jay M. {Ver Hoef} and Alan Pearse and Dan Isaak},</span></span>
<span><span class="co">#&gt;     year = {2023},</span></span>
<span><span class="co">#&gt;     note = {{R} package version 0.2.0},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="input-data">Input Data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h2>
<p>The streams, observation, and prediction datasets must be
pre-processed prior to fitting SSN models and making predictions at
unobserved locations using <code>SSN2</code>. Previously, the STARS
toolset for ArcGIS Desktop versions 9.3x - 10.8x <span class="citation">(E. Peterson and Ver Hoef 2014)</span> or the
<code>openSTARS</code> <strong>R</strong> package <span class="citation">(<strong>kattwinkel2020preparing?</strong>)</span> were
used to generate spatial information required for model fitting and
prediction. However, both software packages have recently been retired
and are replaced by the <code>SSNbler</code> <strong>R</strong> package
<span class="citation">(Erin E. Peterson et al. 2024)</span>, which is a
new, <strong>R</strong>-based version of the STARS tools.
<code>SSNbler</code> is currently available on GitHub (<a href="https://github.com/pet221/SSNbler/" class="external-link">link here</a>), will soon be
available on CRAN, and contains several useful resources that guide
users through these pre-processing steps. Pre-processing using either
<code>SSNbler</code>, STARS, or <code>openSTARS</code> ends with the
creatino of a <code>.ssn</code> folder, which is non-proprietary. Files
residing in the <code>.ssn</code> folder are read into R using
<code><a href="../reference/ssn_import.html">ssn_import()</a></code> from <code>SSN2</code> and palced into a list
structure called an SSN object, which contains all the spatial,
topological, and attribute information needed to leverage the modeling
tools in <code>SSN2</code>. This includes:</p>
<ol style="list-style-type: decimal">
<li>edges: a geopackage of lines representing the linear geometry of the
stream network(s).</li>
<li>sites: a geopackage of site locations where observed data were
collected on the stream network.</li>
<li>prediction sites: one or more geopackages of locations where
predictions will be made. Optional.</li>
<li>netIDx.dat for each stream network: a text file containing
topological relationships for the line segments in edges, by
network.</li>
</ol>
</div>
<div class="section level2">
<h2 id="ssn-objects-in-ssn2">
<code>SSN</code> Objects in <code>SSN2</code><a class="anchor" aria-label="anchor" href="#ssn-objects-in-ssn2"></a>
</h2>
<p>The data contained in the <code>.ssn</code> object are read into R
and stored as an <code>SSN</code> object, which has a special list
structure with four elements:</p>
<ol style="list-style-type: decimal">
<li>
<code>edges</code>: An <code>sf</code> object that contains the
edges with <code>LINESTRING</code> geometry (representing the linear
geometry of the stream network/s). The endpoints of the edges are called
nodes.</li>
<li>
<code>obs</code>: An <code>sf</code> object that contains the
observed data with <code>POINT</code> geometry.</li>
<li>
<code>preds</code> A list of <code>sf</code> objects with
<code>POINT</code> geometry, each containing a set of locations where
predictions will be made.</li>
<li>
<code>path</code>: A character string that represents the path to
the relevant <code>.ssn</code> directory stored on your computer.</li>
</ol>
<p>A <code>netgeom</code> (short for “network geometry”) column is also
added to each of the <code>sf</code> objects stored within an
<code>SSN</code> object. The <code>netgeom</code> column contains a
character string describing the position of each line
(<code>edges</code>) and point (<code>obs</code> and <code>preds</code>)
feature in relation to one another. The format of the
<code>netgeom</code> column differs depending on whether it is
describing a feature with <code>LINESTRING</code> or <code>POINT</code>
geometry. For edges, the format of <code>netgeom</code> is</p>
<p><code>"ENETWORK (netID rid upDist)"</code>,</p>
<p>and for sites</p>
<p><code>"SNETWORK (netID rid upDist ratio pid locID)"</code>,</p>
<p><strong>The data used to define the <code>netgeom</code> column are
found in the edges,</strong> <strong>observed sites, and prediction
sites geopackages, which are created</strong> <strong>using the
<code>SSNbler</code> (recommended), <code>STARS</code>, or
<code>openSTARS</code> software.</strong> For edges, this includes a
unique network identifier (<code>netID</code>) and reach (i.e., edge)
identifier (<code>rid</code>), as well as the distance between the most
downstream location on the stream network (i.e., stream outlet) to the
upstream node of each edge segment, when movement is restricted to the
stream network (<code>upDist</code>). The <code>netgeom</code> column
for sites also contains the <code>netID</code> and <code>rid</code> for
the edge on which the site resides. The point identifier
(<code>pid</code>) is unique to each measurement, while the location
identifier (<code>locID</code>) is unique to each spatial location. Note
that a <code>locID</code> may have multiple <code>pid</code>s associated
with it if there are repeated measurements in the observed data or
multiple predictions are made at the same location. The
<code>upDist</code> value for each site represents the stream distance
between the stream outlet and the site location. Finally, the
<code>ratio</code> is used to describe the relative position of a site
on its associated edge segment. It is the proportional distance from the
most downstream node of the edge segment to the site location. For
example, <code>ratio</code> at a site is close to zero when the site is
close to the most downstream node of the edge segment, and
<code>ratio</code> at a site is close to one when the site is far from
the most downstream node of the edge segment. Together these key pieces
of data are used to describe which network and edge each site resides
on, as well as where exactly the site is on each line segment. It may at
first seem redundant to combine and store multiple numeric columns as
text in the <code>netgeom</code> column. However, these data dictate how
the observed and prediction sites relate to one another in topological
space, which impacts parameter estimates and predicted values generated
from fitted models. Storing these data as text in the
<code>netgeom</code> column significantly reduces the chance that these
values are accidentally (and unknowingly) altered by a user.</p>
<div class="section level3">
<h3 id="the-middle-fork-data">The Middle Fork Data<a class="anchor" aria-label="anchor" href="#the-middle-fork-data"></a>
</h3>
<p>In this vignette, we will use the Middle Fork 2004 stream temperature
data in <code>SSN2</code>. The raw input data are stored in the
<code>lsndata/MiddleFork04.ssn</code> directory installed alongside
<code>SSN2</code>. We may store the file path to this example data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"lsndata/MiddleFork04.ssn"</span>, package <span class="op">=</span> <span class="st">"SSN2"</span><span class="op">)</span></span></code></pre></div>
<p>Several functions in <code>SSN2</code> for reading and writing data
(which we use shortly) directly manipulate the <code>.ssn</code> folder.
If it is not desirable to directly manipulate the
<code>MiddleFork04.ssn</code> data installed alongside
<code>SSN2</code>, <code>MiddleFork04.ssn</code> may be copied it into a
temporary directory and the relevant path to this alternative location
can be stored:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/copy_lsn_to_temp.html">copy_lsn_to_temp</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MiddleFork04.ssn"</span><span class="op">)</span></span></code></pre></div>
<p>After specifying <code>path</code> (using <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code>
or <code><a href="../reference/copy_lsn_to_temp.html">copy_lsn_to_temp()</a></code>), we import the stream reaches,
observed sites, and prediction sites:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mf04p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_import.html">ssn_import</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">path</span>,</span>
<span>  predpts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred1km"</span>, <span class="st">"CapeHorn"</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We summarise the <code>mf04p</code> data by running</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mf04p</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Object of class SSN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object includes observations on 26 variables across 45 sites within the bounding box</span></span>
<span><span class="co">#&gt;       xmin       ymin       xmax       ymax </span></span>
<span><span class="co">#&gt; -1531384.6   914394.3 -1498447.7   933487.5 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object also includes 2 sets of prediction points with a total of 829 locations</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable names are (found using ssn_names(object)):</span></span>
<span><span class="co">#&gt; $obs</span></span>
<span><span class="co">#&gt;  [1] "rid"        "pid"        "STREAMNAME" "COMID"      "AREAWTMAP" </span></span>
<span><span class="co">#&gt;  [6] "SLOPE"      "ELEV_DEM"   "Source"     "Summer_mn"  "MaxOver20" </span></span>
<span><span class="co">#&gt; [11] "C16"        "C20"        "C24"        "FlowCMS"    "AirMEANc"  </span></span>
<span><span class="co">#&gt; [16] "AirMWMTc"   "rcaAreaKm2" "h2oAreaKm2" "ratio"      "snapdist"  </span></span>
<span><span class="co">#&gt; [21] "upDist"     "afvArea"    "locID"      "netID"      "netgeom"   </span></span>
<span><span class="co">#&gt; [26] "geometry"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pred1km</span></span>
<span><span class="co">#&gt;  [1] "rid"        "pid"        "COMID"      "AREAWTMAP"  "SLOPE"     </span></span>
<span><span class="co">#&gt;  [6] "ELEV_DEM"   "FlowCMS"    "AirMEANc"   "AirMWMTc"   "rcaAreaKm2"</span></span>
<span><span class="co">#&gt; [11] "h2oAreaKm2" "ratio"      "snapdist"   "upDist"     "afvArea"   </span></span>
<span><span class="co">#&gt; [16] "locID"      "netID"      "netgeom"    "geom"      </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CapeHorn</span></span>
<span><span class="co">#&gt;  [1] "rid"        "pid"        "COMID"      "AREAWTMAP"  "SLOPE"     </span></span>
<span><span class="co">#&gt;  [6] "ELEV_DEM"   "FlowCMS"    "AirMEANc"   "AirMWMTc"   "rcaAreaKm2"</span></span>
<span><span class="co">#&gt; [11] "h2oAreaKm2" "ratio"      "snapdist"   "upDist"     "afvArea"   </span></span>
<span><span class="co">#&gt; [16] "locID"      "netID"      "netgeom"    "geom"</span></span></code></pre>
<p>We see that <code>mf04p</code> contains 45 observation sites and a
total of 829 prediction sites stored in two different prediction
datasets. We will explore several of these variables throughout the rest
of the vignette:</p>
<ul>
<li>
<code>AREAWTMAP</code>: Precipitation (area-weighted in mm)</li>
<li>
<code>ELEV_DEM</code>: Elevation (based on a 30m DEM)</li>
<li>
<code>Summer_mn</code>: Summer mean stream temperature
(Celsius)</li>
<li>
<code>C16</code>: Number of times daily stream temperature exceeded
16 Celsius (in the summer)</li>
</ul>
<p>A more detailed description of all the variables in
<code>mf04p</code> is available in the documentation and can be seen by
running <code><a href="../reference/MiddleFork04.ssn.html">?MiddleFork04.ssn</a></code> or
<code><a href="../reference/MiddleFork04.ssn.html">help(MiddleFork04.ssn, package = "SSN2")</a></code>. <code>SSN2</code>
currently does not have a generic plotting function for <code>SSN</code>
objects. Instead, we rely on the plotting functionality of
<code>ggplot2</code> <span class="citation">(Wickham 2016)</span> and
<code>sf</code> <span class="citation">(Pebesma 2018)</span>. This
vignette focuses on the use of <code>ggplot2</code>, which we load by
running</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>ggplot2 is only installed alongside <code>SSN2</code> when
<code>dependencies = TRUE</code> in <code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code>, so
check that it is installed before reproducing any visualizations in this
vignette.</p>
<p>Prediction sites can be easily accessed in the <code>SSN</code>
object using the list element number or names attribute. For example, we
print the names of the prediction datasets to the console</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mf04p</span><span class="op">$</span><span class="va">preds</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] "pred1km"  "CapeHorn"</span></span></code></pre>
<p>We view the Middle Fork stream network, overlay the observed sites
where data were collected using brown circles, and overlay the
<code>pred1km</code> prediction locations using smaller, blue triangles
by running</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred1km</span>, pch <span class="op">=</span> <span class="fl">17</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span>, color <span class="op">=</span> <span class="st">"brown"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Later we will fit models to stream network data. Before doing this,
however, we supplement the .ssn object with hydrologic distance matrices
that preserve directionality, which are required for statistical
modeling:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssn_create_distmat.html">ssn_create_distmat</a></span><span class="op">(</span></span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  predpts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred1km"</span>, <span class="st">"CapeHorn"</span><span class="op">)</span>,</span>
<span>  among_predpts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Stream distance matrices are saved as local files the
<code>.ssn</code> directory associated with the <code>SSN</code> object,
<code>mf04p$path</code>, in a folder called <code>distance</code>
created by <code><a href="../reference/ssn_create_distmat.html">ssn_create_distmat()</a></code>. The matrices are stored as
<code>.Rdata</code> files in separate sub-folders for observed sites
(<code>obs</code>) and each set of prediction sites. If the file path to
the <code>.ssn</code> directory is incorrect, the
<code><a href="../reference/ssn_update_path.html">ssn_update_path()</a></code> can be used to update it before the
distance matrices are generated.</p>
</div>
</div>
<div class="section level2">
<h2 id="spatial-stream-network-ssn-models">Spatial Stream Network (SSN) Models<a class="anchor" aria-label="anchor" href="#spatial-stream-network-ssn-models"></a>
</h2>
<div class="section level3">
<h3 id="sec:lm">Linear SSN Models<a class="anchor" aria-label="anchor" href="#sec:lm"></a>
</h3>
<p>We begin by fitting linear models to stream network data using the
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code> function. Later we fit generalized linear models
to stream network data using the <code><a href="../reference/ssn_glm.html">ssn_glm()</a></code> function.
Typically, linear models are used when the response variable (i.e.,
dependent variable) is continuous and not highly skewed, and generalized
linear models are often used when the response variable is binary, a
count, or highly skewed.</p>
<p>Linear spatial stream network models for a quantitative response
vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math>
have spatially dependent random errors and are often parameterized
as</p>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐲</mi><mo>=</mo><mi>𝐗</mi><mi>𝛃</mi><mo>+</mo><msub><mi>𝛕</mi><mrow><mi>t</mi><mi>u</mi></mrow></msub><mo>+</mo><msub><mi>𝛕</mi><mrow><mi>t</mi><mi>d</mi></mrow></msub><mo>+</mo><msub><mi>𝛕</mi><mrow><mi>e</mi><mi>u</mi></mrow></msub><mo>+</mo><mi>𝛜</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation*}
\mathbf{y} = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\tau}_{tu} + \boldsymbol{\tau}_{td} + \boldsymbol{\tau}_{eu} + \boldsymbol{\epsilon},
\end{equation*}</annotation></semantics></math><p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>
is a matrix of explanatory variables (usually including a column of 1’s
for an intercept),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛃</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
is a vector of fixed effects that describe the average impact of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛕</mi><mrow><mi>t</mi><mi>u</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\tau}_{tu}</annotation></semantics></math>
is a vector of spatially dependent (autocorrelated) tail-up random
errors,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛕</mi><mrow><mi>t</mi><mi>d</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\tau}_{td}</annotation></semantics></math>
is a vector of spatially dependent (autocorrelated) tail-down random
errors,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛕</mi><mrow><mi>e</mi><mi>u</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\tau}_{eu}</annotation></semantics></math>
is a vector of spatially dependent (autocorrelated) Euclidean random
errors, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛜</mi><annotation encoding="application/x-tex">\boldsymbol{\epsilon}</annotation></semantics></math>
is a vector of spatially independent (uncorrelated) random errors. The
spatial dependence of each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛕</mi><annotation encoding="application/x-tex">\boldsymbol{\tau}</annotation></semantics></math>
term is explicitly specified using a spatial covariance function that
incorporates the variance of the respective
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛕</mi><annotation encoding="application/x-tex">\boldsymbol{\tau}</annotation></semantics></math>
term, often called a partial sill, and a range parameter that controls
the behavior of the respective spatial covariance. The variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛜</mi><annotation encoding="application/x-tex">\boldsymbol{\epsilon}</annotation></semantics></math>
is often called the nugget (or nugget effect). Sometimes several
unconnected networks are modeled simultaneously. For two observations on
separate networks, tail-up and tail-down random errors are uncorrelated
but Euclidean random errors can be autocorrelated.</p>
<p>Suppose we are interested in studying summer mean temperature
(<code>Summer_mn</code>) on the stream network. We can visualize the
distribution of summer mean temperature (overlain onto the stream
network) by running</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Summer_mn</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>, option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>The <code><a href="../reference/ssn_lm.html">ssn_lm()</a></code> function is used to fit linear spatial
stream network models and bears many similarities to
base-<strong>R</strong>’s <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function for non-spatial
linear models. Below we provide a few commonly used arguments to
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>:</p>
<ul>
<li>
<code>formula</code>: a formula that describes the relationship
between the response variable and explanatory variables.
<ul>
<li>
<code>formula</code> uses the same syntax as the
<code>formula</code> argument in <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>.</li>
</ul>
</li>
<li>
<code>ssn.object</code>: the <code>.ssn</code> object.</li>
<li>
<code>tailup_type</code>: the tail-up covariance, can be
<code>"linear"</code>, <code>"spherical"</code>,
<code>"exponential"</code>, <code>"mariah"</code>, <code>"epa"</code>,
or <code>"none"</code> (the default)</li>
<li>
<code>taildown_type</code>: the tail-down covariance, can be
<code>"linear"</code>, <code>"spherical"</code>,
<code>"exponential"</code>, <code>"mariah"</code>, <code>"epa"</code>,
or <code>"none"</code> (the default)</li>
<li>
<code>euclid_type</code>: the Euclidean covariance, can be
<code>"spherical"</code>, <code>"exponential"</code>,
<code>"gaussian"</code>, <code>"cosine"</code>, <code>"cubic"</code>,
<code>"pentaspherical"</code>, <code>"wave"</code>,
<code>"jbessel"</code>, <code>"gravity"</code>, <code>"rquad"</code>,
<code>"magnetic"</code>, or <code>"none"</code> (the default)</li>
<li>
<code>nugget_type</code>: <code>"nugget"</code> (the default) or
<code>"none"</code>.</li>
</ul>
<p>It is important to note that the default for
<code>tailup_type</code>, <code>taildown_type</code>, and
<code>euclid_type</code> is <code>"none"</code>, which means that they
must be specified if their relevant covariances are desired. The default
for <code>nugget_type</code> is <code>"nugget"</code>, which specifies a
nugget effect, useful because many ecological processes have localized
variability that is important to capture. Full parameterizations of each
covariance function are given in <code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>’s documentation,
which can be viewed by running <code><a href="../reference/ssn_lm.html">help("ssn_lm", "SSN2")</a></code>.
There are different approaches to choosing between covariance functions.
One approach is to fit several models and compare their fits using
statistics like AIC or cross-validation error. Another approach is to
visualize the <code><a href="../reference/Torgegram.html">Torgegram()</a></code> and choose functions
appropriately.</p>
<p>The <code><a href="../reference/Torgegram.html">Torgegram()</a></code> in SSN2 is essentially a semivariogram
that describes variability in streams data based on flow-connected,
flow-unconnected, and Euclidean spatial relationships. Like other
semivariograms, the Torgegram describes how the semivariance
(i.e. halved average squared difference) between observations changes
with hydrologic or Euclidean distances. If there is strong dependence
between sites based on flow-connected or flow-unconnected relationships,
the semivariance will increase with respective distance. If, however,
there is not strong dependence, the semivariance will be relatively
flat. The <code><a href="../reference/Torgegram.html">Torgegram()</a></code> output can be combined with
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to better understand which covariance components may
be most suitable in the model. For example, when the semivariance for
flow-connected sites increases with hydrologic distance but the
semivariance for flow-unconnected sites is flat, then a tail-up
component may be sufficient for the model (i.e., a tail-down component
is not needed). However, the model would likely benefit from a tail-down
component or a combination of tail-up and tail-down models if the
semivariance for both flow-connected and flow-unconnected sites
increases with distance. Alternatively, if the semivariance is flat,
then the model is unlikely to benefit from tail-up or tail-down
components. SSN2 also allows users to visualize changes in semivariance
based on Euclidean distance, which may provide additional insights about
whether a Euclidean component or a mixture of tail-up, tail-down and/or
Euclidean models will improve the model. Please see <span class="citation">Zimmerman and Ver Hoef (2017)</span> for a more
in-depth review of Toregegrams, along with strategies for interpreting
and using them to inform model fitting. For a more formal comparison
between models, use statistics like <code>AIC</code> or cross-validation
error, which we discuss later.</p>
<p>Suppose that we want to model summer mean stream temperature as a
function of elevation and precipitation. We can aid our understanding of
what covariance components may be informative by visualizing a
Torgegram:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Torgegram.html">Torgegram</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flowcon"</span>, <span class="st">"flowuncon"</span>, <span class="st">"euclid"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The first argument to <code><a href="../reference/Torgegram.html">Torgegram()</a></code> is
<code>formula</code>. Residuals from a non-spatial linear model
specified by <code>formula</code> are used by the Toregram to visualize
remaining spatial dependence. The <code>type</code> argument specifies
the Torgegram types and has a default value of
<code>c("flowcon", "flowuncon")</code> for both flow-connected and
flow-unconnected semivariances. Here we also desire to visualize
Euclidean semivariance. We visualize all three components by running</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tg</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>The flow-connected semivariances seem to generally increase with
distance, which suggests that the model will benefit from at least a
tail-up component. The takeaway for flow-unconnected and Euclidean
semivariances is less clear – they seem to generally increase with
distance but there are some short distances with high semivariances. We
more empirically investigate the impact of each dependence structure
next while we fit a model with all three components: tail-up, tail-down,
and Euclidean.</p>
<p>We fit a spatial stream network model regressing summer mean stream
temperature on elevation and watershed-averaged precipitation using an
exponential tail-up covariance function with additive weights created
using watershed area (<code>afvArea</code>), a spherical tail-down
covariance function, a Gaussian Euclidean covariance function, and a
nugget effect by running</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The estimation method is specified via the <code>estmethod</code>
argument, which has a default value of <code>"reml"</code> for
restricted maximum likelihood (REML). The other estimation method is
<code>"ml"</code> for maximum likelihood (ML). REML is chosen as the
default because it tends to yield more accurate covariance parameter
estimates than ML, especially for small sample sizes. One nuance of
REML, however, is that comparisons of likelihood-based statistics like
AIC are only valid when the models have the same fixed effects structure
(i.e., the same <code>formula</code>). To compare fixed effects and
covariance structures simultaneously, use ML or a model comparison tool
that is not likelihood-based, such as cross validation via
<code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code>, which we discuss later.</p>
<div class="section level4">
<h4 id="model-summaries">Model Summaries<a class="anchor" aria-label="anchor" href="#model-summaries"></a>
</h4>
<p>We summarize the fitted model by running</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Summer_mn ~ ELEV_DEM + AREAWTMAP, ssn.object = mf04p, </span></span>
<span><span class="co">#&gt;     tailup_type = "exponential", taildown_type = "spherical", </span></span>
<span><span class="co">#&gt;     euclid_type = "gaussian", additive = "afvArea")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -2.73430 -1.43161 -0.04368  0.83251  1.39377 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 78.214857  12.189379   6.417 1.39e-10 ***</span></span>
<span><span class="co">#&gt; ELEV_DEM    -0.028758   0.005808  -4.952 7.35e-07 ***</span></span>
<span><span class="co">#&gt; AREAWTMAP   -0.008067   0.004125  -1.955   0.0505 .  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pseudo R-squared: 0.4157</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;               Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;   tailup exponential  de (parsill)  1.348e+00</span></span>
<span><span class="co">#&gt;   tailup exponential         range  8.987e+05</span></span>
<span><span class="co">#&gt;   taildown spherical  de (parsill)  2.647e+00</span></span>
<span><span class="co">#&gt;   taildown spherical         range  1.960e+05</span></span>
<span><span class="co">#&gt;      euclid gaussian  de (parsill)  1.092e-04</span></span>
<span><span class="co">#&gt;      euclid gaussian         range  1.805e+05</span></span>
<span><span class="co">#&gt;               nugget        nugget  1.660e-02</span></span></code></pre>
<p>Similar to summaries of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> objects, summaries of
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code> objects include the original function call,
residuals, and a coefficients table of fixed effects. The
<code>(Intercept)</code> represents the average summer mean stream
temperature at sea level (an elevation of zero) and no precipitation,
<code>ELEV_DEM</code> represents the decrease in average summer mean
stream temperature with a one unit (meter) increase in elevation, and
<code>AREAWTMAP</code> represents the decrease in average summer mean
stream temperature with a one unit (mm) increase in precipitation. There
is strong evidence that average summer mean stream temperature decreases
with elevation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>0.001</mn></mrow><annotation encoding="application/x-tex">&lt; 0.001</annotation></semantics></math>),
while there is moderate evidence that average summer mean stream
temperature decreases with precipitation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≈</mo><annotation encoding="application/x-tex">\approx</annotation></semantics></math>
0.05). A pseudo r-squared is also returned, which quantifies the
proportion of variability explained by the fixed effects. The
coefficients table of covariance parameters describes the model’s
dependence. The larger the <code>de</code> parameter, the more
variability in the process is attributed to the relevant effect. Here,
most of the model’s random variability comes from the tail-up and
tail-down portions of the model. The larger the <code>range</code>
parameter, the more autocorrelated nearby observations are with respect
to the relevant effect.</p>
<p>We directly compare the sources of variability in the model using the
<code>varcomp</code> function:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/varcomp.html" class="external-link">varcomp</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   varcomp            proportion</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Covariates (PR-sq)  0.416    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> tailup_de           0.196    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> taildown_de         0.386    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> euclid_de           0.000<span style="text-decoration: underline;">015</span>9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> nugget              0.002<span style="text-decoration: underline;">42</span></span></span></code></pre>
<p>Most of the variability in summer mean stream temperature is
explained by the fixed effects of elevation and precipitation
(<code>Covariates (PR-sq)</code>), the tail-up component, and the
tail-down component. Note that the values in the <code>proportion</code>
column sum to one.</p>
<p>In the remainder of this subsection, we describe the broom <span class="citation">(Robinson, Hayes, and Couch 2021)</span> functions
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>, <code><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance()</a></code> and <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>.
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> tidies coefficient output in a convenient
<code>tibble</code>, <code><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance()</a></code> glances at model-fit
statistics, and <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> augments the data with fitted
model diagnostics.</p>
<p>We tidy the fixed effects (and add confidence intervals) by
running</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">ssn_mod</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic  p.value conf.low   conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept) 78.2      12.2          6.42 1.39<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>  54.3    102.       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AREAWTMAP   -<span style="color: #BB0000;">0.008</span><span style="color: #BB0000; text-decoration: underline;">07</span>   0.004<span style="text-decoration: underline;">13</span>     -<span style="color: #BB0000;">1.96</span> 5.05<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>  -<span style="color: #BB0000;">0.016</span><span style="color: #BB0000; text-decoration: underline;">2</span>   0.000<span style="text-decoration: underline;">018</span>7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ELEV_DEM    -<span style="color: #BB0000;">0.028</span><span style="color: #BB0000; text-decoration: underline;">8</span>    0.005<span style="text-decoration: underline;">81</span>     -<span style="color: #BB0000;">4.95</span> 7.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 7</span>  -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">1</span>  -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">4</span></span></span></code></pre>
<p>We glance at the model-fit statistics by running</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 9</span></span></span>
<span><span class="co">#&gt;       n     p  npar value   AIC  AICc logLik deviance pseudo.r.squared</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    45     3     7  76.6  90.6  93.7  -<span style="color: #BB0000;">38.3</span>     41.8            0.416</span></span></code></pre>
<p>The columns of this <code>tibble</code> represent:</p>
<ul>
<li>
<code>n</code>: The sample size.</li>
<li>
<code>p</code>: The number of fixed effects (linearly independent
columns in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>).</li>
<li>
<code>npar</code>: The number of estimated covariance
parameters.</li>
<li>
<code>value</code>: The value of the minimized objective function
used when fitting the model.</li>
<li>
<code>AIC</code>: The Akaike Information Criterion (AIC).</li>
<li>
<code>AICc</code>: The AIC with a small sample size correction.</li>
<li>
<code>logLik</code>: The log-likelihood.</li>
<li>
<code>deviance</code>: The deviance.</li>
<li>
<code>pseudo.r.squared</code>: The pseudo r-squared.</li>
</ul>
<p>The <code><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances()</a></code> function can be used to glance at multiple
models at once. Suppose we wanted to compare the current model to a new
model that omits the tail-up and Euclidean components. We do this using
<code><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances()</a></code> by running</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances</a></span><span class="op">(</span><span class="va">ssn_mod</span>, <span class="va">ssn_mod2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 10</span></span></span>
<span><span class="co">#&gt;   model        n     p  npar value   AIC  AICc logLik deviance pseudo.r.squared</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ssn_mod     45     3     7  76.6  90.6  93.7  -<span style="color: #BB0000;">38.3</span>     41.8            0.416</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ssn_mod2    45     3     3 130.  136.  137.   -<span style="color: #BB0000;">65.1</span>     41.9            0.180</span></span></code></pre>
<p>Often AIC and AICc are used for model selection, as they balance
model fit and model simplicity. The lower AIC and AICc for the original
model (<code>ssn_mod</code>) indicates it is a better fit to the data
(than <code>ssn_mod2</code>). Outside of <code><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance()</a></code> and
<code><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances()</a></code>, the functions <code><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC()</a></code>,
<code><a href="https://usepa.github.io/spmodel/reference/AIC.spmodel.html" class="external-link">AICc()</a></code>, <code><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik()</a></code>, <code><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance()</a></code>, and
<code><a href="https://usepa.github.io/spmodel/reference/pseudoR2.html" class="external-link">pseudoR2()</a></code> are available to compute the relevant
statistics. Note that <code>additive</code> is only required when the
tail-up covariance is specified. We are able to compare <code>AIC</code>
and <code>AICc</code> for these models fit using REML because we are
only changing the covariance structure, not the fixed effects structure.
To compare <code>AIC</code> and <code>AICc</code> for models with
varying fixed effect and covariance structures, use ML. For example, we
compare a model with and without elevation to assess its importance:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ml_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  estmethod <span class="op">=</span> <span class="st">"ml"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ml_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  estmethod <span class="op">=</span> <span class="st">"ml"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances</a></span><span class="op">(</span><span class="va">ml_mod</span>, <span class="va">ml_mod2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 10</span></span></span>
<span><span class="co">#&gt;   model       n     p  npar value   AIC  AICc logLik deviance pseudo.r.squared</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ml_mod     45     3     7  60.2  80.2  86.7  -<span style="color: #BB0000;">30.1</span>     45.4           0.461 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ml_mod2    45     2     7  72.9  90.9  96.0  -<span style="color: #BB0000;">36.4</span>     44.9           0.023<span style="text-decoration: underline;">7</span></span></span></code></pre>
<p>Elevation seems important to model fit, as evidenced by the lower
AIC. <span class="citation">Erin E. Peterson and Ver Hoef (2010)</span>
describe a two-step model procedure for model selection based on AIC
when comparing models with varying covariance and fixed structures.
First, all covariance components are included (tail-up, tail-down,
Euclidean, nugget) and fixed effects are compared using ML. Then using
the model with the lowest AIC, refit using REML and compare models with
varying combinations of covariance components. Finally, proceed with the
model having the lowest AIC. Another approach is to compare a suite of
models (having varying fixed effect and covariance components) using ML
and then refit the best model using REML. Henceforth, we proceed with
the REML models, <code>ssn_mod</code> and <code>ssn_mod2</code>.</p>
<p>Another way to compare model fits is leave-one-out cross validation
available via the <code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code> function. <code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code>
returns many model-fit statistics. One of these in the
root-mean-squared-prediction error, which captures the typical absolute
error associated with a prediction. We can compare the
mean-squared-prediction error between <code>ssn_mod</code>,
<code>ssn_mod2</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loocv_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="va">loocv_mod</span><span class="op">$</span><span class="va">RMSPE</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.4800386</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loocv_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod2</span><span class="op">)</span></span>
<span><span class="va">loocv_mod2</span><span class="op">$</span><span class="va">RMSPE</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.8150308</span></span></code></pre>
<p><code>ssn_mod</code> is the better model with respect to
<code>AIC</code>, <code>AICc</code>, and <code>RMSPE</code> and shortly
we use it to return model diagnostics and make predictions. Note that
model comparison using <code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code> does not depend on the
estimation method (ML vs REML).</p>
<p>We augment the data with model diagnostics by running</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="va">aug_ssn_mod</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Simple feature collection with 45 features and 9 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1530805 ymin: 920324.3 xmax: -1503079 ymax: 931036.6</span></span>
<span><span class="co">#&gt; Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 45 × 10</span></span></span>
<span><span class="co">#&gt;    Summer_mn ELEV_DEM AREAWTMAP .fitted  .resid    .hat .cooksd .std.resid pid  </span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      14.9     <span style="text-decoration: underline;">1</span>947     <span style="text-decoration: underline;">1</span>001.    14.1  0.770  0.072<span style="text-decoration: underline;">4</span>  2.74<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     0.337  1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      14.7     <span style="text-decoration: underline;">1</span>952     <span style="text-decoration: underline;">1</span>001.    14.0  0.714  0.056<span style="text-decoration: underline;">9</span>  4.49<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>    -<span style="color: #BB0000;">0.048</span><span style="color: #BB0000; text-decoration: underline;">6</span> 2    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      14.6     <span style="text-decoration: underline;">1</span>958     <span style="text-decoration: underline;">1</span>001.    13.8  0.776  0.062<span style="text-decoration: underline;">9</span>  2.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     0.352  3    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      15.2     <span style="text-decoration: underline;">1</span>923     <span style="text-decoration: underline;">1</span>007.    14.8  0.427  0.125   4.71<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>     1.06   4    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      14.5     <span style="text-decoration: underline;">1</span>932     <span style="text-decoration: underline;">1</span>007.    14.5 -<span style="color: #BB0000;">0.043</span><span style="color: #BB0000; text-decoration: underline;">7</span> 0.035<span style="text-decoration: underline;">9</span>  3.43<span style="color: #949494;">e</span><span style="color: #BB0000;">-2</span>    -<span style="color: #BB0000;">1.69</span>   5    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      15.3     <span style="text-decoration: underline;">1</span>940     <span style="text-decoration: underline;">1</span>009.    14.3  1.01   0.022<span style="text-decoration: underline;">0</span>  3.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     0.670  6    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      15.1     <span style="text-decoration: underline;">1</span>940     <span style="text-decoration: underline;">1</span>010.    14.3  0.797  0.017<span style="text-decoration: underline;">8</span>  1.05<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>    -<span style="color: #BB0000;">0.133</span>  7    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      14.9     <span style="text-decoration: underline;">1</span>945     <span style="text-decoration: underline;">1</span>013.    14.1  0.833  0.002<span style="text-decoration: underline;">13</span> 8.13<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>    -<span style="color: #BB0000;">0.338</span>  8    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      15.0     <span style="text-decoration: underline;">1</span>948     <span style="text-decoration: underline;">1</span>025.    13.9  1.06   0.056<span style="text-decoration: underline;">0</span>  1.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>     0.098<span style="text-decoration: underline;">8</span> 9    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      15.0     <span style="text-decoration: underline;">1</span>950     <span style="text-decoration: underline;">1</span>025.    13.9  1.15   0.047<span style="text-decoration: underline;">1</span>  6.84<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>     0.660  10   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 35 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: geometry &lt;POINT [m]&gt;</span></span></span></code></pre>
<p>The columns of this tibble represent:</p>
<ul>
<li>
<code>Summer_mn</code>: Summer mean stream temperature.</li>
<li>
<code>ELEV_DEM</code>: Elevation.</li>
<li>
<code>AREAWTMAP</code>: Precipitation.</li>
<li>
<code>.fitted</code>: The fitted values (the estimated mean given
the explanatory variable values).</li>
<li>
<code>.resid</code>: The residuals (the response minus the fitted
values).</li>
<li>
<code>.hat</code>: The leverage (hat) values.</li>
<li>
<code>.cooksd</code>: The Cook’s distance.</li>
<li>
<code>.std.residuals</code>: Standardized residuals.</li>
<li>
<code>pid</code>: The <code>pid</code> value.</li>
<li>
<code>geometry</code>: The spatial information in the
<code>sf</code> object.</li>
</ul>
<p>By default, <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> only returns the variables in the
data used by the model. All variables from the original data are
returned by setting <code>drop = FALSE</code>. We can write the
augmented data to a geopackage by loading <code>sf</code> (which comes
installed alongside <code>SSN2</code>) and running</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">aug_ssn_mod</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/aug_ssn_mod.gpkg"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Many of the model diagnostics returned by <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> can
be visualized by running using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. For example, we plot
the fitted values against the standardized residuals by running</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ssn_mod</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>There are 6 total diagnostic plots (specified via the
<code>which</code> argument) that return the same information returned
from running <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on an <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> object.</p>
</div>
<div class="section level4">
<h4 id="prediction-kriging">Prediction (Kriging)<a class="anchor" aria-label="anchor" href="#prediction-kriging"></a>
</h4>
<p>Commonly a goal of a data analysis is to make predictions at
unobserved locations. In spatial contexts, prediction is often called
Kriging. Next we make summer mean stream temperature predictions at each
location in the <code>pred1km</code> data in <code>mf04p</code> by
running</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred1km"</span><span class="op">)</span></span></code></pre></div>
<p>While <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> was previously used to augment the
original data with model diagnostics, it can also be used to augment the
<code>newdata</code> with predictions:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred1km"</span><span class="op">)</span></span>
<span><span class="va">aug_preds</span><span class="op">[</span>, <span class="st">".fitted"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Simple feature collection with 175 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1530631 ymin: 914920.7 xmax: -1500020 ymax: 933466.4</span></span>
<span><span class="co">#&gt; Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 175 × 2</span></span></span>
<span><span class="co">#&gt;    .fitted            geometry</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    14.7 (-1528406 928161.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    14.7 (-1528202 928821.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    14.9 (-1528173 929414.9)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    14.4 (-1530218 926538.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    14.5 (-1529466 926808.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    14.5 (-1520657 929871.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    15.0 (-1519866 930025.5)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    14.7 (-1521823 930124.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    14.9 (-1523183 930469.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    15.2 (-1523860 930665.8)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 165 more rows</span></span></span></code></pre>
<p>Here <code>.fitted</code> represents the predictions. Confidence
intervals for the mean response or prediction intervals for the
predicted response can be obtained by specifying the
<code>interval</code> argument in <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> and
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>. By default, <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> and
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> compute 95% intervals, though this can be changed
using the <code>level</code> argument. The arguments for
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> and <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> on
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code> objects is slightly different than the same
arguments for an <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> object – to learn more run
<code><a href="../reference/predict.SSN2.html">help("predict.SSN2", "SSN2")</a></code> or
<code><a href="../reference/augment.SSN2.html">help("augment.SSN2", "SSN2")</a></code>.</p>
<p>We visualize these predictions (overlain onto the stream network) by
running</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aug_preds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>, option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>Previously we wrote out model diagnostics to a geopackage. Now we
write out predictions to a geopackage (recall <code>sf</code> must be
loaded) by running</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">aug_preds</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/aug_preds.gpkg"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>When performing prediction in <code>SSN2</code>, the name of
<code>newdata</code> must be the name of a prediction data set contained
in <code>ssn.object$preds</code>. If <code>newdata</code> is omitted or
has the value <code>"all"</code>, prediction is performed for all
prediction data sets in <code>ssn.object</code>. For example,</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p>makes predictions for <code>pred1km</code> and <code>CapeHorn</code>
(the names of <code>mf04p$preds</code>). Lastly, if there are
observations (in the <code>obs</code> object) whose response is missing
(<code>NA</code>), these observations are removed from model fitting and
moved to a prediction data set named <code>.missing</code>. Then
predictions can be obtained at these locations.</p>
<p>We can also predict the average value in a region using block
Prediction (instead of making point predictions). We predict the average
summer mean temperature throughout the Middle Fork stream network by
running</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred1km"</span>, block <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;        fit      lwr      upr</span></span>
<span><span class="co">#&gt; 1 10.21747 9.317693 11.11725</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="sec:advanced">Advanced Features<a class="anchor" aria-label="anchor" href="#sec:advanced"></a>
</h4>
<p>There are several additional modeling tools available in
<code>SSN2</code> that we discuss next: Fixing parameter values;
non-spatial random effects; and partition factors.</p>
<p>Perhaps we want to assume a particular covariance parameter is known.
This may be reasonable if information is known about the process or the
desire is to perform model selection for nested models or create profile
likelihood confidence intervals. Fixing covariance parameters in
<code>SSN2</code> is accomplished via the <code>tailup_initial</code>,
<code>taildown_initial</code>, <code>euclid_initial</code>, and
<code>nugget_initial</code> arguments to <code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>. These
arguments are passed an appropriate initial value object created using
the <code><a href="../reference/ssn_initial.html">tailup_initial()</a></code>, <code><a href="../reference/ssn_initial.html">taildown_initial()</a></code>,
<code><a href="../reference/ssn_initial.html">euclid_initial()</a></code>, or <code><a href="../reference/ssn_initial.html">nugget_initial()</a></code>
function, respectively. For example, suppose we want to fix the
Euclidean dependent error variance parameter (i.e., Euclidean partial
sill, or parsill) at 1, forcing this component to have a moderate effect
on the covariance. First, we specify the appropriate object by
running</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euclid_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_initial.html">euclid_initial</a></span><span class="op">(</span><span class="st">"gaussian"</span>, de <span class="op">=</span> <span class="fl">1</span>, known <span class="op">=</span> <span class="st">"de"</span><span class="op">)</span></span>
<span><span class="va">euclid_init</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $initial</span></span>
<span><span class="co">#&gt; de </span></span>
<span><span class="co">#&gt;  1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $is_known</span></span>
<span><span class="co">#&gt;   de </span></span>
<span><span class="co">#&gt; TRUE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "euclid_gaussian"</span></span></code></pre>
<p>The <code>euclid_init</code> output shows that the <code>de</code>
parameter has an initial value of 1 that is assumed known. The
<code>range</code> parameter will still be estimated. Next the model is
fit:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_initial <span class="op">=</span> <span class="va">euclid_init</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ssn_init</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Summer_mn ~ ELEV_DEM + AREAWTMAP, ssn.object = mf04p, </span></span>
<span><span class="co">#&gt;     tailup_type = "exponential", taildown_type = "spherical", </span></span>
<span><span class="co">#&gt;     euclid_initial = euclid_init, additive = "afvArea")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt; (Intercept)     ELEV_DEM    AREAWTMAP  </span></span>
<span><span class="co">#&gt;   71.247739    -0.026707    -0.005522  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;               Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;   tailup exponential  de (parsill)  1.250e+00</span></span>
<span><span class="co">#&gt;   tailup exponential         range  4.191e+05</span></span>
<span><span class="co">#&gt;   taildown spherical  de (parsill)  1.924e-02</span></span>
<span><span class="co">#&gt;   taildown spherical         range  3.125e+04</span></span>
<span><span class="co">#&gt;      euclid gaussian  de (parsill)  1.000e+00</span></span>
<span><span class="co">#&gt;      euclid gaussian         range  9.998e+03</span></span>
<span><span class="co">#&gt;               nugget        nugget  3.578e-02</span></span></code></pre>
<p>Random effects can be added to an SSN model to incorporate additional
sources of variability separate from those on the stream network. Common
additional sources of variability modeled include repeated observations
at sites or network-specific effects. The random effects are modeled
using similar syntax as for random effects in the <code>nlme</code>
<span class="citation">(Pinheiro and Bates 2006)</span> and
<code>lme4</code> <span class="citation">(Bates et al. 2015)</span>
<strong>R</strong> packages, being specified via a formula passed to the
<code>random</code> argument. We model random intercepts for each of the
two networks in the data by running</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">netID</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ssn_rand</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Summer_mn ~ ELEV_DEM + AREAWTMAP, ssn.object = mf04p, </span></span>
<span><span class="co">#&gt;     tailup_type = "exponential", taildown_type = "spherical", </span></span>
<span><span class="co">#&gt;     euclid_type = "gaussian", additive = "afvArea", random = ~as.factor(netID))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt; (Intercept)     ELEV_DEM    AREAWTMAP  </span></span>
<span><span class="co">#&gt;   59.579720    -0.020328    -0.006484  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;               Effect             Parameter   Estimate</span></span>
<span><span class="co">#&gt;   tailup exponential          de (parsill)  1.128e+00</span></span>
<span><span class="co">#&gt;   tailup exponential                 range  2.015e+05</span></span>
<span><span class="co">#&gt;   taildown spherical          de (parsill)  2.948e-03</span></span>
<span><span class="co">#&gt;   taildown spherical                 range  8.357e+04</span></span>
<span><span class="co">#&gt;      euclid gaussian          de (parsill)  1.397e+00</span></span>
<span><span class="co">#&gt;      euclid gaussian                 range  1.096e+04</span></span>
<span><span class="co">#&gt;               nugget                nugget  2.977e-02</span></span>
<span><span class="co">#&gt;               random  1 | as.factor(netID)  4.370e+00</span></span></code></pre>
<p><code>random = ~ as.factor(netID)</code> is short-hand for
<code>random = ~ (1 | as.factor(netID))</code>, which is the more
familiar <code>lme4</code> or <code>nlme</code> syntax.</p>
<p>A partition factor is a variable that allows observations to be
uncorrelated when they do not share the same value. For example, one may
want to partition the model into two networks (despite their adjacency)
because of a significant land mass (or similar obstruction). In this
case, it may be relevant to assume observations upstream of the land
mass are not correlated with observations downstream of the land mass.
Incorporating an effect as a partition factor is different from
incorporating the effect as fixed (i.e., on the right-hand side of the
<code>formula</code> argument). Partition factors affect the covariance
portion of the model while fixed effects affect the mean portion.</p>
<p>Partition factors are modeled using a formula that contains a single
variable passed to the <code>partition_factor</code> argument:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  partition_factor <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">netID</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ssn_part</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Summer_mn ~ ELEV_DEM + AREAWTMAP, ssn.object = mf04p, </span></span>
<span><span class="co">#&gt;     tailup_type = "exponential", taildown_type = "spherical", </span></span>
<span><span class="co">#&gt;     euclid_type = "gaussian", additive = "afvArea", partition_factor = ~as.factor(netID))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt; (Intercept)     ELEV_DEM    AREAWTMAP  </span></span>
<span><span class="co">#&gt;   77.421289    -0.028431    -0.007938  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;               Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;   tailup exponential  de (parsill)  1.331e+00</span></span>
<span><span class="co">#&gt;   tailup exponential         range  9.689e+05</span></span>
<span><span class="co">#&gt;   taildown spherical  de (parsill)  2.923e+00</span></span>
<span><span class="co">#&gt;   taildown spherical         range  1.880e+05</span></span>
<span><span class="co">#&gt;      euclid gaussian  de (parsill)  1.654e-04</span></span>
<span><span class="co">#&gt;      euclid gaussian         range  2.458e+01</span></span>
<span><span class="co">#&gt;               nugget        nugget  1.487e-02</span></span></code></pre>
<p>Here, the partition factor ensures that observations from separate
stream networks are completely uncorrelated.</p>
<!-- resulting from Euclidean distance (these observations already do not share any tail-up or tail-down covariance because they are from separate stream networks). -->
</div>
</div>
<div class="section level3">
<h3 id="sec:glm">Generalized Linear SSN Models<a class="anchor" aria-label="anchor" href="#sec:glm"></a>
</h3>
<p>Generalized linear spatial stream network models for a response
vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math>
have spatially dependent random errors and are often parameterized
as</p>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>𝐗</mi><mi>𝛃</mi><mo>+</mo><msub><mi>𝛕</mi><mrow><mi>t</mi><mi>u</mi></mrow></msub><mo>+</mo><msub><mi>𝛕</mi><mrow><mi>t</mi><mi>d</mi></mrow></msub><mo>+</mo><msub><mi>𝛕</mi><mrow><mi>e</mi><mi>u</mi></mrow></msub><mo>+</mo><mi>𝛜</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation*}
g(\boldsymbol{\mu}) = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\tau}_{tu} + \boldsymbol{\tau}_{td} + \boldsymbol{\tau}_{eu} + \boldsymbol{\epsilon},
\end{equation*}</annotation></semantics></math><p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛍</mi><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math>
is the mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>
is a link function that “links”
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛍</mi><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math>
to a linear function of the predictor variables and random errors, and
all other terms are the same as those defined for linear spatial stream
network models. Rather than assuming
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
is normally (Gaussian) distributed as is often the case with linear
spatial stream network models, generalized linear spatial stream network
models assume
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\mathbf{y}</annotation></semantics></math>
follows one of many distributions and has a corresponding link function.
Below we summarize the families of generalized linear spatial stream
network models supported by <code>SSN2</code> their link functions, and
the type of data typically associated with these families. For more on
generalized linear models more generally, see <span class="citation">McCullagh and Nelder (1989)</span>, <span class="citation">Myers et al. (2012)</span>, and <span class="citation">Faraway (2016)</span>.</p>
<p>The <code><a href="../reference/ssn_glm.html">ssn_glm()</a></code> function is used to fit generalized linear
spatial stream network models and bears many similarities to
base-<strong>R</strong>’s <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function for non-spatial
generalized linear models. The family (i.e., response distribution) is
controlled by the <code>family</code> argument. When <code>family</code>
is <code>Gaussian()</code>, the model fit is equivalent to one fit using
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>. Note that parameters are estimated on the
relevant link scale and should be interpreted accordingly.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Family</th>
<th>Link Function</th>
<th>Link Name</th>
<th>Data Type</th>
<th>
<code>SSN2</code> Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Gaussian</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>𝛍</mi></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \mathbf{\mu}</annotation></semantics></math></td>
<td>Identity</td>
<td>Continuous</td>
<td>
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>; <code><a href="../reference/ssn_glm.html">ssn_glm()</a></code>
</td>
</tr>
<tr class="even">
<td>Binomial</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \log(\mathbf{\mu} / (1 - \mathbf{\mu}))</annotation></semantics></math></td>
<td>Logit</td>
<td>Binary; Binary Count</td>
<td><code><a href="../reference/ssn_glm.html">ssn_glm()</a></code></td>
</tr>
<tr class="odd">
<td>Beta</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \log(\mathbf{\mu} / (1 - \mathbf{\mu}))</annotation></semantics></math></td>
<td>Logit</td>
<td>Proportion</td>
<td><code><a href="../reference/ssn_glm.html">ssn_glm()</a></code></td>
</tr>
<tr class="even">
<td>Poisson</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \log(\mathbf{\mu})</annotation></semantics></math></td>
<td>Log</td>
<td>Count</td>
<td><code><a href="../reference/ssn_glm.html">ssn_glm()</a></code></td>
</tr>
<tr class="odd">
<td>Negative Binomial</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \log(\mathbf{\mu})</annotation></semantics></math></td>
<td>Log</td>
<td>Count</td>
<td><code><a href="../reference/ssn_glm.html">ssn_glm()</a></code></td>
</tr>
<tr class="even">
<td>Gamma</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \log(\mathbf{\mu})</annotation></semantics></math></td>
<td>Log</td>
<td>Skewed (positive continuous)</td>
<td><code><a href="../reference/ssn_glm.html">ssn_glm()</a></code></td>
</tr>
<tr class="odd">
<td>Inverse Gaussian</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛍</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{\mu}) = \log(\mathbf{\mu})</annotation></semantics></math></td>
<td>Log</td>
<td>Skewed (positive continuous)</td>
<td><code><a href="../reference/ssn_glm.html">ssn_glm()</a></code></td>
</tr>
</tbody>
</table>
<p>The <code>C16</code> variable in <code>mf04p</code> represents the
number of times daily summer stream temperature exceeded 16 Celsius:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">C16</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<p>Suppose we want to model <code>C16</code> as a function of elevation
and precipitation. Often count data are modeled using Poisson
regression. Using tail-up, tail-down, and nugget components, we fit this
Poisson model by running</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_glm.html">ssn_glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">C16</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"epa"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"mariah"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The previous <code>SSN2</code> functions used to explore linear
spatial stream network models are also available for generalized linear
spatial stream network models. For example, we can summarize the model
using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_pois</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_glm(formula = C16 ~ ELEV_DEM + AREAWTMAP, ssn.object = mf04p, </span></span>
<span><span class="co">#&gt;     family = "poisson", tailup_type = "epa", taildown_type = "mariah", </span></span>
<span><span class="co">#&gt;     additive = "afvArea")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals:</span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -3.10387 -0.36874 -0.05467  0.27401  1.37106 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 45.889749   9.803696   4.681 2.86e-06 ***</span></span>
<span><span class="co">#&gt; ELEV_DEM    -0.018206   0.004547  -4.004 6.24e-05 ***</span></span>
<span><span class="co">#&gt; AREAWTMAP   -0.006715   0.002958  -2.270   0.0232 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pseudo R-squared: 0.2527</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;            Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;        tailup epa  de (parsill)  6.358e-01</span></span>
<span><span class="co">#&gt;        tailup epa         range  3.090e+04</span></span>
<span><span class="co">#&gt;   taildown mariah  de (parsill)  7.500e-02</span></span>
<span><span class="co">#&gt;   taildown mariah         range  2.878e+06</span></span>
<span><span class="co">#&gt;            nugget        nugget  1.289e-03</span></span>
<span><span class="co">#&gt;        dispersion    dispersion  1.000e+00</span></span></code></pre>
<p>Similar to summaries of <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> objects, summaries of
<code><a href="../reference/ssn_glm.html">ssn_glm()</a></code> objects include the original function call,
deviance residuals, and a coefficients table of fixed effects. The
<code>(Intercept)</code> represents the log average <code>C16</code> at
sea level (an elevation of zero) and zero precipitation,
<code>ELEV_DEM</code> represents the decrease in log average summer mean
temperature with a one unit (meter) increase in elevation, and
<code>AREAWTMAP</code> represents the decrease in log average summer
mean temperature with a one unit (mm) increase in precipitation. There
is strong evidence that log average summer mean temperature decreases
with elevation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>0.001</mn></mrow><annotation encoding="application/x-tex">&lt; 0.001</annotation></semantics></math>),
while there is moderate evidence that log average summer mean
temperature decreases with precipitation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≈</mo><annotation encoding="application/x-tex">\approx</annotation></semantics></math>
0.03). Recall that the covariance parameter estimates are on the link
(here, log) scale.</p>
<p>The Poisson model assumes that each observations mean and variance
are equal. Often with ecological or environmental data, the variance is
larger than the mean – this is called overdispersion. The negative
binomial model accommodates overdispersion for count data. We fit a
negative binomial model by running</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssn_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_glm.html">ssn_glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">C16</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"nbinomial"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"epa"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"mariah"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can compare the fit of these models using leave-one-out cross
validation by running</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loocv_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_pois</span><span class="op">)</span></span>
<span><span class="va">loocv_pois</span><span class="op">$</span><span class="va">RMSPE</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 6.015313</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loocv_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_nb</span><span class="op">)</span></span>
<span><span class="va">loocv_nb</span><span class="op">$</span><span class="va">RMSPE</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 5.875028</span></span></code></pre>
<p>The negative binomial model has a lower <code>RMSPE</code>, which
suggests some evidence of overdispersion. Other ways to assess the
impact of overdispersion include 1) comparing the models using a
likelihood-based fit statistic like AIC; if the AIC values are similar
there is little evidence of overdispersion – and 2) inspecting the
dispersion parameter estimates of the negative binomial model; if the
dispersion parameter is very large, there is little evidence of
overdispersion.</p>
<p>All advanced modeling features discussed for linear spatial stream
network models (e.g., fixing covariance parameter values, random
effects, partition factors) are also available for generalized linear
spatial stream network models.</p>
</div>
<div class="section level3">
<h3 id="simulating-spatial-stream-network-data">Simulating Spatial Stream Network Data<a class="anchor" aria-label="anchor" href="#simulating-spatial-stream-network-data"></a>
</h3>
<p>The <code><a href="../reference/ssn_simulate.html">ssn_simulate()</a></code> function is used to simulate data on
a stream network. First, covariance parameter values are specified and a
seed set:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tu_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">tailup_params</a></span><span class="op">(</span><span class="st">"exponential"</span>, de <span class="op">=</span> <span class="fl">0.4</span>, range <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span></span>
<span><span class="va">td_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">taildown_params</a></span><span class="op">(</span><span class="st">"spherical"</span>, de <span class="op">=</span> <span class="fl">0.1</span>, range <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span><span class="va">euc_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">euclid_params</a></span><span class="op">(</span><span class="st">"gaussian"</span>, de <span class="op">=</span> <span class="fl">0.2</span>, range <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span><span class="va">nug_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">nugget_params</a></span><span class="op">(</span><span class="st">"nugget"</span>, nugget <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Then call <code><a href="../reference/ssn_simulate.html">ssn_simulate()</a></code>, specifying the
<code>family</code> argument depending on the type of simulated data
desired (here, Gaussian), the <code>ssn.object</code> and the network
(here, the observed network):</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_simulate.html">ssn_simulate</a></span><span class="op">(</span></span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  network <span class="op">=</span> <span class="st">"obs"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  tailup_params <span class="op">=</span> <span class="va">tu_params</span>,</span>
<span>  taildown_params <span class="op">=</span> <span class="va">td_params</span>,</span>
<span>  euclid_params <span class="op">=</span> <span class="va">euc_params</span>,</span>
<span>  nugget_params <span class="op">=</span> <span class="va">nug_params</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] -0.8022248 -0.4047795  0.3819883 -1.0798647 -0.8943244 -0.4111767</span></span></code></pre>
<p>We simulate binomial (presence/absence) data by running</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_simulate.html">ssn_simulate</a></span><span class="op">(</span></span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  network <span class="op">=</span> <span class="st">"obs"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  tailup_params <span class="op">=</span> <span class="va">tu_params</span>,</span>
<span>  taildown_params <span class="op">=</span> <span class="va">td_params</span>,</span>
<span>  euclid_params <span class="op">=</span> <span class="va">euc_params</span>,</span>
<span>  nugget_params <span class="op">=</span> <span class="va">nug_params</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      1 2</span></span>
<span><span class="co">#&gt; [1,] 0 1</span></span>
<span><span class="co">#&gt; [2,] 0 1</span></span>
<span><span class="co">#&gt; [3,] 0 1</span></span>
<span><span class="co">#&gt; [4,] 1 1</span></span>
<span><span class="co">#&gt; [5,] 1 0</span></span>
<span><span class="co">#&gt; [6,] 0 0</span></span></code></pre>
<p>Currently, <code><a href="../reference/ssn_simulate.html">ssn_simulate()</a></code> only works on the observed
network (<code>network = "obs"</code>). However, simulation in
<code>SSN2</code> will be a focus of future updates, and we plan to add
support for simulating on prediction networks as well as observed and
prediction networks simultaneously.</p>
</div>
</div>
<div class="section level2">
<h2 id="function-glossary">Function Glossary<a class="anchor" aria-label="anchor" href="#function-glossary"></a>
</h2>
<p>Here we list the two <code>SSN2</code> functions used to fit
models:</p>
<ul>
<li>
<code><a href="../reference/ssn_glm.html">ssn_glm()</a></code>: Fit a spatial stream network generalized
linear model.</li>
<li>
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>: Fit a spatial stream network linear
model.</li>
</ul>
<p>Here we list some commonly used <code>SSN2</code> functions that
operate on model fits:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC()</a></code>: Compute the AIC.</li>
<li>
<code><a href="https://usepa.github.io/spmodel/reference/AIC.spmodel.html" class="external-link">AICc()</a></code>: Compute the AICc.</li>
<li>
<code><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova()</a></code>: Perform an analysis of variance.</li>
<li>
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>: Augment data with diagnostics or new data
with predictions.</li>
<li>
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>: Return coefficients.</li>
<li>
<code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>: Compute confidence intervals.</li>
<li>
<code><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">cooks.distance()</a></code>: Compute Cook’s distance.</li>
<li>
<code><a href="https://usepa.github.io/spmodel/reference/covmatrix.html" class="external-link">covmatrix()</a></code>: Return covariance matrices.</li>
<li>
<code><a href="https://rdrr.io/r/stats/deviance.html" class="external-link">deviance()</a></code>: Compute the deviance.</li>
<li>
<code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>: Compute fitted values.</li>
<li>
<code><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance()</a></code>: Glance at a fitted model.</li>
<li>
<code><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances()</a></code>: Glance at multiple fitted models.</li>
<li>
<code><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hatvalues()</a></code>: Compute leverage (hat) values.</li>
<li>
<code><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik()</a></code>: Compute the log-likelihood.</li>
<li>
<code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code>: Perform leave-one-out cross validation and
compute relevant statistics.</li>
<li>
<code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code>: Return the model matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>).</li>
<li>
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>: Create fitted model plots.</li>
<li>
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>: Compute predictions and prediction
intervals.</li>
<li>
<code><a href="https://usepa.github.io/spmodel/reference/pseudoR2.html" class="external-link">pseudoR2()</a></code>: Compute the pseudo r-squared.</li>
<li>
<code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code>: Compute residuals.</li>
<li>
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>: Summarize fitted models.</li>
<li>
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>: Tidy fitted models.</li>
<li>
<code><a href="https://usepa.github.io/spmodel/reference/varcomp.html" class="external-link">varcomp()</a></code>: Compare variance components.</li>
<li>
<code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code>: Compute variance-covariance matrices of
estimated parameters.</li>
</ul>
<p>Documentation for these functions can be found by running
<code>?function_name.SSN2</code> or
<code>help("function_name.SSN2", "SSN2")</code>. For example,
<code><a href="../reference/predict.SSN2.html">?predict.SSN2</a></code> or
<code><a href="../reference/predict.SSN2.html">help("predict.SSN2", "SSN2")</a></code>.</p>
<p>Here we list some commonly used <code>SSN2</code> functions for
manipulating <code>SSN</code> objects:</p>
<ul>
<li>
<code><a href="../reference/ssn_create_distmat.html">ssn_create_distmat()</a></code>: Create distance matrices in the
<code>.ssn</code> directory for use with modeling functions.</li>
<li>
<code><a href="../reference/ssn_get_data.html">ssn_get_data()</a></code>: Extract an <code>sf</code>
<code>data.frame</code> of observed or prediction locations from the
<code>SSN</code> object.</li>
<li>
<code><a href="../reference/ssn_get_netgeom.html">ssn_get_netgeom()</a></code>: Extract topological information from
the <code>netgeom</code> column.</li>
<li>
<code><a href="../reference/ssn_get_stream_distmat.html">ssn_get_stream_distmat()</a></code>: Extract the stream distance
matrices for the observed or prediction locations in an <code>SSN</code>
object.</li>
<li>
<code><a href="../reference/ssn_import.html">ssn_import()</a></code>: Import an <code>SSN</code> object from an
<code>.ssn</code> directory.</li>
<li>
<code><a href="../reference/ssn_import_predpts.html">ssn_import_predpts()</a></code>: Import prediction data and store
within an existing <code>SSN</code> object.</li>
<li>
<code><a href="../reference/ssn_put_data.html">ssn_put_data()</a></code>: Replace an <code>sf</code>
<code>data.frame</code> of observed or prediction locations in an
<code>SSN</code> object.</li>
<li>
<code><a href="../reference/ssn_split_predpts.html">ssn_split_predpts()</a></code>: Split prediction data stored
within an <code>SSN</code> object into multiple prediction data
sets.</li>
<li>
<code><a href="../reference/ssn_subset.html">ssn_subset()</a></code>: Subset an existing <code>SSN</code>
object based on a logical expression.</li>
<li>
<code><a href="../reference/SSN_to_SSN2.html">SSN_to_SSN2()</a></code>: Convert an S4
<code>SpatialStreamNetwork</code> object created in the <code>SSN</code>
to an S3 <code>SSN</code> object used in <code>SSN2</code>.</li>
<li>
<code><a href="../reference/ssn_update_path.html">ssn_update_path()</a></code>: Update the <code>path</code> element
of an <code>SSN</code> object.</li>
<li>
<code><a href="../reference/ssn_write.html">ssn_write()</a></code>: Write an <code>SSN</code> project to a new
local <code>.ssn</code> directory.</li>
</ul>
<p>All functions that manipulate <code>SSN</code> objects have an
<code>ssn_</code> prefix, which makes them easily accessible via tab
completion in RStudio.</p>
<p>Here we list some commonly used miscellaneous <code>SSN2</code>
functions:</p>
<ul>
<li>
<code><a href="../reference/ssn_simulate.html">ssn_simulate()</a></code>: Simulate spatially autocorrelated
random variables on a stream network.</li>
</ul>
<p>For a full list of <code>SSN2</code> functions alongside their
documentation, see the documentation manual.</p>
</div>
<div class="section level2">
<h2 id="from-ssn-to-ssn2">From <code>SSN</code> to <code>SSN2</code><a class="anchor" aria-label="anchor" href="#from-ssn-to-ssn2"></a>
</h2>
<p>Here we present a table of <code>SSN</code> functions and provide
their relevant successors in <code>SSN2</code>:</p>
<table class="table">
<colgroup>
<col width="34%">
<col width="65%">
</colgroup>
<thead><tr class="header">
<th>
<code>SSN</code> Function Name</th>
<th>
<code>SSN2</code> Function Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC()</a></code></td>
<td>
<code><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC()</a></code>; <code><a href="https://usepa.github.io/spmodel/reference/AIC.spmodel.html" class="external-link">AICc()</a></code>
</td>
</tr>
<tr class="even">
<td><code>BlockPredict()</code></td>
<td><code>predict(…, block = TRUE)</code></td>
</tr>
<tr class="odd">
<td><code>BLUP()</code></td>
<td><code>fitted(…, type)</code></td>
</tr>
<tr class="even">
<td><code>covparms()</code></td>
<td>
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>; <code>tidy(..., effects)</code>
</td>
</tr>
<tr class="odd">
<td><code>createDistMat()</code></td>
<td><code><a href="../reference/ssn_create_distmat.html">ssn_create_distmat()</a></code></td>
</tr>
<tr class="even">
<td><code>CrossValidationSSN()</code></td>
<td><code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code></td>
</tr>
<tr class="odd">
<td><code>CrossValidationStatsSSN()</code></td>
<td><code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code></td>
</tr>
<tr class="even">
<td><code>EmpiricalSemivariogram()</code></td>
<td><code>Torgegram(…, type)</code></td>
</tr>
<tr class="odd">
<td><code>getSSNdata.frame()</code></td>
<td><code><a href="../reference/ssn_get_data.html">ssn_get_data()</a></code></td>
</tr>
<tr class="even">
<td><code>getStreamDistMat()</code></td>
<td><code><a href="../reference/ssn_get_stream_distmat.html">ssn_get_stream_distmat()</a></code></td>
</tr>
<tr class="odd">
<td><code>glmssn()</code></td>
<td>
<code><a href="../reference/ssn_glm.html">ssn_glm()</a></code>; <code><a href="../reference/ssn_lm.html">ssn_lm()</a></code>
</td>
</tr>
<tr class="even">
<td><code>GR2()</code></td>
<td><code><a href="https://usepa.github.io/spmodel/reference/pseudoR2.html" class="external-link">pseudoR2()</a></code></td>
</tr>
<tr class="odd">
<td><code>importPredpts()</code></td>
<td><code><a href="../reference/ssn_import_predpts.html">ssn_import_predpts()</a></code></td>
</tr>
<tr class="even">
<td><code>importSSN()</code></td>
<td><code><a href="../reference/ssn_import.html">ssn_import()</a></code></td>
</tr>
<tr class="odd">
<td><code>InfoCritCompare()</code></td>
<td>
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>; <code><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance()</a></code>;
<code><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances()</a></code>; <code><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv()</a></code>
</td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code></td>
<td><code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code></td>
</tr>
<tr class="odd">
<td><code>putSSNdata.frame()</code></td>
<td><code><a href="../reference/ssn_put_data.html">ssn_put_data()</a></code></td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code></td>
<td><code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code></td>
</tr>
<tr class="odd">
<td><code>SimulateOnSSN()</code></td>
<td><code><a href="../reference/ssn_simulate.html">ssn_simulate()</a></code></td>
</tr>
<tr class="even">
<td><code>splitPredictions()</code></td>
<td><code><a href="../reference/ssn_split_predpts.html">ssn_split_predpts()</a></code></td>
</tr>
<tr class="odd">
<td><code>subsetSSN()</code></td>
<td><code><a href="../reference/ssn_subset.html">ssn_subset()</a></code></td>
</tr>
<tr class="even">
<td><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code></td>
<td><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code></td>
</tr>
<tr class="odd">
<td><code><a href="../reference/Torgegram.html">Torgegram()</a></code></td>
<td><code>Torgegram(…, type)</code></td>
</tr>
<tr class="even">
<td><code>updatePath()</code></td>
<td><code><a href="../reference/ssn_update_path.html">ssn_update_path()</a></code></td>
</tr>
<tr class="odd">
<td><code><a href="https://usepa.github.io/spmodel/reference/varcomp.html" class="external-link">varcomp()</a></code></td>
<td><code><a href="https://usepa.github.io/spmodel/reference/varcomp.html" class="external-link">varcomp()</a></code></td>
</tr>
<tr class="even">
<td><code>writeSSN()</code></td>
<td><code><a href="../reference/ssn_write.html">ssn_write()</a></code></td>
</tr>
</tbody>
</table>
<p>In addition to the function name changes above, a few function
argument names also changed. Please read the documentation for each
function of interest to see its relevant argument name changes.</p>
</div>
<div class="section level2">
<h2 id="the-future-of-ssn2">The Future of <code>SSN2</code><a class="anchor" aria-label="anchor" href="#the-future-of-ssn2"></a>
</h2>
<p>There are several features we have planned for future versions of
<code>SSN2</code> that did not make it into the initial release due to
the October timeline regarding the <code>rgdal</code>,
<code>rgeos</code>, and <code>maptools</code> retirements. As such, we
plan to regularly update and add features to <code>SSN2</code> in the
coming years – so check back often! Some of these features include
additional tools for large data sets (both model fitting and
prediction), manipulating the <code>.ssn</code> object, simulating data,
and more. We will do our best to make future versions of
<code>SSN2</code> backward compatible with this version, but minor
changes may occur until we are ready to release version 1.0.0.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="r-code-appendix">R Code Appendix<a class="anchor" aria-label="anchor" href="#r-code-appendix"></a>
</h2>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/" class="external-link">SSN2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"SSN2"</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"lsndata/MiddleFork04.ssn"</span>, package <span class="op">=</span> <span class="st">"SSN2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/copy_lsn_to_temp.html">copy_lsn_to_temp</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"MiddleFork04.ssn"</span><span class="op">)</span></span>
<span><span class="va">mf04p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_import.html">ssn_import</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">path</span>,</span>
<span>  predpts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred1km"</span>, <span class="st">"CapeHorn"</span><span class="op">)</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mf04p</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mf04p</span><span class="op">$</span><span class="va">preds</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred1km</span>, pch <span class="op">=</span> <span class="fl">17</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span>, color <span class="op">=</span> <span class="st">"brown"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ssn_create_distmat.html">ssn_create_distmat</a></span><span class="op">(</span></span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  predpts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred1km"</span>, <span class="st">"CapeHorn"</span><span class="op">)</span>,</span>
<span>  among_predpts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Summer_mn</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>, option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Torgegram.html">Torgegram</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flowcon"</span>, <span class="st">"flowuncon"</span>, <span class="st">"euclid"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tg</span><span class="op">)</span></span>
<span><span class="va">ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/varcomp.html" class="external-link">varcomp</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">ssn_mod</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="va">ssn_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances</a></span><span class="op">(</span><span class="va">ssn_mod</span>, <span class="va">ssn_mod2</span><span class="op">)</span></span>
<span><span class="va">ml_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  estmethod <span class="op">=</span> <span class="st">"ml"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ml_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  estmethod <span class="op">=</span> <span class="st">"ml"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/glances.html" class="external-link">glances</a></span><span class="op">(</span><span class="va">ml_mod</span>, <span class="va">ml_mod2</span><span class="op">)</span></span>
<span><span class="va">loocv_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="va">loocv_mod</span><span class="op">$</span><span class="va">RMSPE</span></span>
<span><span class="va">loocv_mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod2</span><span class="op">)</span></span>
<span><span class="va">loocv_mod2</span><span class="op">$</span><span class="va">RMSPE</span></span>
<span><span class="va">aug_ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="va">aug_ssn_mod</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">aug_ssn_mod</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/aug_ssn_mod.gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ssn_mod</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred1km"</span><span class="op">)</span></span>
<span><span class="va">aug_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred1km"</span><span class="op">)</span></span>
<span><span class="va">aug_preds</span><span class="op">[</span>, <span class="st">".fitted"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aug_preds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>, option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">aug_preds</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/aug_preds.gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred1km"</span>, block <span class="op">=</span> <span class="cn">TRUE</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="va">euclid_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_initial.html">euclid_initial</a></span><span class="op">(</span><span class="st">"gaussian"</span>, de <span class="op">=</span> <span class="fl">1</span>, known <span class="op">=</span> <span class="st">"de"</span><span class="op">)</span></span>
<span><span class="va">euclid_init</span></span>
<span><span class="va">ssn_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_initial <span class="op">=</span> <span class="va">euclid_init</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ssn_init</span></span>
<span><span class="va">ssn_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">netID</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ssn_rand</span></span>
<span><span class="va">ssn_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"spherical"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  partition_factor <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">netID</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ssn_part</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">edges</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mf04p</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">C16</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ssn_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_glm.html">ssn_glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">C16</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"epa"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"mariah"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_pois</span><span class="op">)</span></span>
<span><span class="va">ssn_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_glm.html">ssn_glm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">C16</span> <span class="op">~</span> <span class="va">ELEV_DEM</span> <span class="op">+</span> <span class="va">AREAWTMAP</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"nbinomial"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"epa"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"mariah"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">loocv_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_pois</span><span class="op">)</span></span>
<span><span class="va">loocv_pois</span><span class="op">$</span><span class="va">RMSPE</span></span>
<span><span class="va">loocv_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_nb</span><span class="op">)</span></span>
<span><span class="va">loocv_nb</span><span class="op">$</span><span class="va">RMSPE</span></span>
<span><span class="va">tu_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">tailup_params</a></span><span class="op">(</span><span class="st">"exponential"</span>, de <span class="op">=</span> <span class="fl">0.4</span>, range <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span></span>
<span><span class="va">td_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">taildown_params</a></span><span class="op">(</span><span class="st">"spherical"</span>, de <span class="op">=</span> <span class="fl">0.1</span>, range <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span><span class="va">euc_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">euclid_params</a></span><span class="op">(</span><span class="st">"gaussian"</span>, de <span class="op">=</span> <span class="fl">0.2</span>, range <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span><span class="va">nug_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_params.html">nugget_params</a></span><span class="op">(</span><span class="st">"nugget"</span>, nugget <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_simulate.html">ssn_simulate</a></span><span class="op">(</span></span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  network <span class="op">=</span> <span class="st">"obs"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  tailup_params <span class="op">=</span> <span class="va">tu_params</span>,</span>
<span>  taildown_params <span class="op">=</span> <span class="va">td_params</span>,</span>
<span>  euclid_params <span class="op">=</span> <span class="va">euc_params</span>,</span>
<span>  nugget_params <span class="op">=</span> <span class="va">nug_params</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_simulate.html">ssn_simulate</a></span><span class="op">(</span></span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span>
<span>  network <span class="op">=</span> <span class="st">"obs"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  tailup_params <span class="op">=</span> <span class="va">tu_params</span>,</span>
<span>  taildown_params <span class="op">=</span> <span class="va">td_params</span>,</span>
<span>  euclid_params <span class="op">=</span> <span class="va">euc_params</span>,</span>
<span>  nugget_params <span class="op">=</span> <span class="va">nug_params</span>,</span>
<span>  mean <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  samples <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bates2015lme4" class="csl-entry">
Bates, Douglas, Martin Mächler, Ben Bolker, and Steve Walker. 2015.
<span>“Fitting Linear Mixed-Effects Models Using <span class="nocase">lme4</span>.”</span> <em>Journal of Statistical
Software</em> 67 (1): 1–48. <a href="https://doi.org/10.18637/jss.v067.i01" class="external-link">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-bivand2021rgdal" class="csl-entry">
Bivand, Roger, Tim Keitt, and Barry Rowlingson. 2021. <em>Rgdal:
Bindings for the ’Geospatial’ Data Abstraction Library</em>. <a href="https://CRAN.R-project.org/package=rgdal" class="external-link">https://CRAN.R-project.org/package=rgdal</a>.
</div>
<div id="ref-bivand2021maptools" class="csl-entry">
Bivand, Roger, and Nicholas Lewin-Koh. 2021. <em>Maptools: Tools for
Handling Spatial Objects</em>. <a href="https://CRAN.R-project.org/package=maptools" class="external-link">https://CRAN.R-project.org/package=maptools</a>.
</div>
<div id="ref-bivand2020rgeos" class="csl-entry">
Bivand, Roger, and Colin Rundel. 2020. <em>Rgeos: Interface to Geometry
Engine - Open Source (’GEOS’)</em>. <a href="https://CRAN.R-project.org/package=rgeos" class="external-link">https://CRAN.R-project.org/package=rgeos</a>.
</div>
<div id="ref-cressie2006spatial" class="csl-entry">
Cressie, Noel, Jesse Frey, Bronwyn Harch, and Mick Smith. 2006.
<span>“Spatial Prediction on a River Network.”</span> <em>Journal of
Agricultural, Biological, and Environmental Statistics</em> 11: 127–50.
</div>
<div id="ref-dumelle2023spmodel" class="csl-entry">
Dumelle, Michael, Matt Higham, and Jay M Ver Hoef. 2023. <span>“Spmodel:
Spatial Statistical Modeling and Prediction in r.”</span> <em>Plos
One</em> 18 (3): e0282524.
</div>
<div id="ref-faraway2016extending" class="csl-entry">
Faraway, Julian J. 2016. <em>Extending the Linear Model with r:
Generalized Linear, Mixed Effects and Nonparametric Regression
Models</em>. Chapman; Hall/CRC.
</div>
<div id="ref-isaak2014applications" class="csl-entry">
Isaak, Daniel J, Erin E Peterson, Jay M Ver Hoef, Seth J Wenger, Jeffrey
A Falke, Christian E Torgersen, Colin Sowder, et al. 2014.
<span>“Applications of Spatial Statistical Network Models to Stream
Data.”</span> <em>Wiley Interdisciplinary Reviews: Water</em> 1 (3):
277–94.
</div>
<div id="ref-mccullagh1989generalized" class="csl-entry">
McCullagh, Peter, and John A Nelder. 1989. <em>Generalized Linear
Models, 2nd Edition</em>. Chapman &amp; Hall Ltd.
</div>
<div id="ref-myers2012generalized" class="csl-entry">
Myers, Raymond H, Douglas C Montgomery, G Geoffrey Vining, and Timothy J
Robinson. 2012. <em>Generalized Linear Models: With Applications in
Engineering and the Sciences</em>. John Wiley &amp; Sons.
</div>
<div id="ref-nowosad2023" class="csl-entry">
Nowosad, Jakub. 2023. <span>“Upcoming Changes to Popular <span>R</span>
Packages for Spatial Data: What You Need to Do.”</span> June 4, 2023. <a href="https://geocompx.org//post/2023/rgdal-retirement" class="external-link">https://geocompx.org//post/2023/rgdal-retirement</a>.
</div>
<div id="ref-pebesma2018sf" class="csl-entry">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R:
Standardized Support for Spatial Vector Data</span>.”</span>
<em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009" class="external-link">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-peterson2024SSNbler" class="csl-entry">
Peterson, Erin E., Michael Dumelle, Alan Pearse, Dan Teleki, and Jay M.
Ver Hoef. 2024. <em><span>SSNbler</span>: Assemble SSN Objects in
<span>R</span></em>. <a href="https://github.com/pet221/SSNbler" class="external-link">https://github.com/pet221/SSNbler</a>.
</div>
<div id="ref-peterson2013modelling" class="csl-entry">
Peterson, Erin E., Jay M. Ver Hoef, Dan J. Isaak, Jeffrey A. Falke,
Marie-Jose Fortin, Chris E. Jordan, Kristina McNyset, et al. 2013.
<span>“Modelling Dendritic Ecological Networks in Space: An Integrated
Network Perspective.”</span> <em>Ecology Letters</em> 16 (5): 707–19.
</div>
<div id="ref-peterson2010mixed" class="csl-entry">
Peterson, Erin E, and Jay M Ver Hoef. 2010. <span>“A Mixed-Model
Moving-Average Approach to Geostatistical Modeling in Stream
Networks.”</span> <em>Ecology</em> 91 (3): 644–51.
</div>
<div id="ref-peterson2014stars" class="csl-entry">
Peterson, Erin, and Jay Ver Hoef. 2014. <span>“STARS: An ArcGIS Toolset
Used to Calculate the Spatial Information Needed to Fit Spatial
Statistical Models to Stream Network Data.”</span> <em>Journal of
Statistical Software</em> 56: 1–17.
</div>
<div id="ref-pinheiro2006mixed" class="csl-entry">
Pinheiro, José, and Douglas Bates. 2006. <em>Mixed-Effects Models in s
and s-PLUS</em>. Springer science &amp; business media.
</div>
<div id="ref-robinson2021broom" class="csl-entry">
Robinson, David, Alex Hayes, and Simon Couch. 2021. <em>Broom: Convert
Statistical Objects into Tidy Tibbles</em>. <a href="https://CRAN.R-project.org/package=broom" class="external-link">https://CRAN.R-project.org/package=broom</a>.
</div>
<div id="ref-ver2010moving" class="csl-entry">
Ver Hoef, Jay M, and Erin E Peterson. 2010. <span>“A Moving Average
Approach for Spatial Statistical Models of Stream Networks.”</span>
<em>Journal of the American Statistical Association</em> 105 (489):
6–18.
</div>
<div id="ref-ver2006spatial" class="csl-entry">
Ver Hoef, Jay M, Erin Peterson, and David Theobald. 2006. <span>“Spatial
Statistical Models That Use Flow and Stream Distance.”</span>
<em>Environmental and Ecological Statistics</em>.
</div>
<div id="ref-ver2014ssn" class="csl-entry">
Ver Hoef, Jay, Erin Peterson, David Clifford, and Rohan Shah. 2014.
<span>“SSN: An <span>R</span> Package for Spatial Statistical Modeling
on Stream Networks.”</span> <em>Journal of Statistical Software</em> 56:
1–45.
</div>
<div id="ref-wickham2016ggplot2" class="csl-entry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data
Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org" class="external-link">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-zimmerman2017torgegram" class="csl-entry">
Zimmerman, Dale L, and Jay M Ver Hoef. 2017. <span>“The Torgegram for
Fluvial Variography: Characterizing Spatial Dependence on Stream
Networks.”</span> <em>Journal of Computational and Graphical
Statistics</em> 26 (2): 253–64.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Dumelle, Jay M. Ver Hoef, Erin Peterson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
