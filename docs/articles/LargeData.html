<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting Spatial Stream Network Models to Large Data Sets and Making Predictions (i.e., Kriging) • SSN2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Spatial Stream Network Models to Large Data Sets and Making Predictions (i.e., Kriging)">
<meta property="og:description" content="SSN2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SSN2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">An Introduction to Spatial Stream Network Modeling in R Using SSN2</a>
    </li>
    <li>
      <a href="../articles/StreamCatTools.html">Adding Landscape Explanatory Variables to 'SSN' Objects Directly in R Using StreamCatTools</a>
    </li>
    <li>
      <a href="../articles/LargeData.html">Fitting Spatial Stream Network Models to Large Data Sets and Making Predictions (i.e., Kriging)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USEPA/SSN2/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting Spatial Stream Network Models to Large
Data Sets and Making Predictions (i.e., Kriging)</h1>
                        <h4 data-toc-skip class="author">Michael
Dumelle</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USEPA/SSN2/blob/HEAD/vignettes/articles/LargeData.Rmd" class="external-link"><code>vignettes/articles/LargeData.Rmd</code></a></small>
      <div class="hidden name"><code>LargeData.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>It can be challenging to fit SSN models to large data sets because
the computation burden associated with estimating spatial covariance
parameters increases exponentially with <span class="math inline">\(n\)</span>, the sample size. Typically, it is only
feasible to fit SSN2 models using the standard (i.e., traditional)
approach for data sets having no more than a few thousand observations.
<span class="citation">Ver Hoef et al. (2023)</span> proposed an
approach called spatial indexing that can be used to fit SSN models
having tens to hundreds of thousands of observations relatively quickly.
<span class="citation">Ver Hoef et al. (2023)</span> and <span class="citation">Dumelle et al. (2024)</span> show that spatial indexing
tends to approximate the standard solution very accurately at a fraction
of the computational cost via several simulation studies and data
analyses. Spatial indexing works by splitting the data up into smaller
subsets (<span class="math inline">\(n_{subset} &lt;&lt; n\)</span>) and
pooling spatial covariance parameters estimates across these subsets.
This vignette aims to compare the standard approach and large data
(i.e., spatial indexing) approach directly on a moderately sized data
set, whereby the standard approach can be fit relatively quickly. In
<code>SSN2</code>, spatial indexing is available via the
<code>local</code> argument to <code><a href="../reference/ssn_lm.html">ssn_lm()</a></code> and
<code><a href="../reference/ssn_glm.html">ssn_glm()</a></code>.</p>
<p>Interestingly, the main computational burden associated with
prediction at new locations is actually related to the size of the
observed data (<span class="math inline">\(n\)</span>), not the number
of locations requiring prediction (<span class="math inline">\(n_{pred})\)</span>. <span class="citation">Ver
Hoef et al. (2023)</span> describe an approach to prediction at new
locations using models fit to large (observed) data sets called local
neighborhood prediction. Local neighborhood prediction subsets the
observed data to include only the <code>size</code> observations most
correlated with the location requiring prediction (where
<code>size</code> is an integer). Typically, this subsetting is done
separately for each prediction location. However, due to computational
constraints associated with the hydrologic distance matrices required by
SSN models, local neighborhood prediction in <code>SSN2</code> subsets
the observed data to the <code>size</code> observations most correlated
(on average) with all locations requiring prediction. In
<code>SSN2</code>, local neighborhood prediction is available via the
<code>local</code> argument to <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> and
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>.</p>
<p>Before proceeding, we load the <code>SSN2</code> and
<code>ggplot2</code> <strong>R</strong> packages (which can all be
installed directly from CRAN) by running:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/">SSN2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-bugs-data">The <code>bugs</code> Data<a class="anchor" aria-label="anchor" href="#the-bugs-data"></a>
</h2>
<p>The <code>bugs</code> data is an SSN object that contains
macroinvertebrate data in the Lower Snake Basin. It can be downloaded
via GitHub at <a href="https://github.com/USEPA/SSN2/tree/develop/vignettes/articles" class="external-link">this
link</a>. We read in <code>bugs</code> by running:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_import.html">ssn_import</a></span><span class="op">(</span><span class="st">"bugs.ssn"</span>, predpts <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span></code></pre></div>
<p>There are 549 observed sites (<span class="math inline">\(n\)</span>)
and 300 prediction sites (<span class="math inline">\(n_{pred}\)</span>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bugs</span></span>
<span><span class="co">#&gt; Object of class SSN</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object includes observations on 13 variables across 549 sites within the bounding box</span></span>
<span><span class="co">#&gt;     xmin     ymin     xmax     ymax </span></span>
<span><span class="co">#&gt; -1765346  2459843 -1343175  2909567 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Object also includes 1 set of prediction points with 300 locations</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable names are (found using ssn_names(object)):</span></span>
<span><span class="co">#&gt; $obs</span></span>
<span><span class="co">#&gt;  [1] "comid"     "ELEV_DEM"  "AREAWTMAP" "Rich"      "rid"       "ratio"    </span></span>
<span><span class="co">#&gt;  [7] "upDist"    "afvArea"   "locID"     "netID"     "pid"       "geometry" </span></span>
<span><span class="co">#&gt; [13] "netgeom"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $pred</span></span>
<span><span class="co">#&gt;  [1] "comid"     "ELEV_DEM"  "AREAWTMAP" "rid"       "ratio"     "upDist"   </span></span>
<span><span class="co">#&gt;  [7] "afvArea"   "locID"     "netID"     "pid"       "geom"      "netgeom"</span></span></code></pre></div>
<p>We visualize the flowlines (edges), observed macroinvertebrate
richness (obs), and prediction sites (preds) by running:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Rich</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="LargeData_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="the-standard-ssn-approach">The Standard SSN Approach<a class="anchor" aria-label="anchor" href="#the-standard-ssn-approach"></a>
</h2>
<p>Before fitting a standard SSN model to the <code>bugs</code> data, we
create the hydrologic distance matrices required for model fitting by
running:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssn_create_distmat.html">ssn_create_distmat</a></span><span class="op">(</span><span class="va">bugs</span>, predpts <span class="op">=</span> <span class="st">"pred"</span>, among_predpts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Then we fit a standard SSN model by running:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">standard_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Rich</span> <span class="op">~</span> <span class="va">ELEV_DEM</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">bugs</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">standard_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">standard_start</span></span>
<span><span class="va">standard_time</span></span>
<span><span class="co">#&gt; Time difference of 5.222182 secs</span></span></code></pre></div>
<p>The model took 5.22 seconds to fit.</p>
<p>We augment the prediction data with predictions by running:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred"</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-large-data-ssn-approach-i-e--spatial-indexing">The Large Data SSN Approach (i.e., Spatial Indexing)<a class="anchor" aria-label="anchor" href="#the-large-data-ssn-approach-i-e--spatial-indexing"></a>
</h2>
<p>We create the hydrologic distance matrices required for fitting SSN
models to large data sets via spatial indexing using
<code><a href="../reference/ssn_create_bigdist.html">ssn_create_bigdist()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssn_create_bigdist.html">ssn_create_bigdist</a></span><span class="op">(</span><span class="va">bugs</span>, predpts <span class="op">=</span> <span class="st">"pred"</span>, among_predpts <span class="op">=</span> <span class="cn">TRUE</span>, no_cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Like <code><a href="../reference/ssn_create_distmat.html">ssn_create_distmat()</a></code>,
<code><a href="../reference/ssn_create_bigdist.html">ssn_create_bigdist()</a></code> creates distance matrices in the
<code>distance</code> folder of the <code>.ssn</code>. However, the
distance matrices created by <code><a href="../reference/ssn_create_bigdist.html">ssn_create_bigdist()</a></code> have a
special <code>.bmat</code> or <code>.txt</code> extension (instead of a
<code>.Rdata</code>) extension. Distance matrices with
<code>.bmat</code> and <code>.txt</code> extensions are accessed when we
implement spatial indexing via the <code>local</code> argument:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">bd_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ssn_mod_bd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Rich</span> <span class="op">~</span> <span class="va">ELEV_DEM</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">bugs</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  local <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bd_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">bd_start</span></span>
<span><span class="va">bd_time</span></span>
<span><span class="co">#&gt; Time difference of 2.370396 secs</span></span></code></pre></div>
<p>The model took 2.37 seconds to fit.</p>
<p>The <code>local</code> argument set to <code>TRUE</code> implements
default settings of a more complex <code>local</code> list that has
several options controlling nuances of the spatial indexing. One of
these options is the method used to assign observations to smaller
subsets. The default approach is k-means clustering, chosen so that each
smaller subset has a sample size of approximately 200. We can access the
smaller subsets used by the model object and visualize them by
running:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span><span class="op">$</span><span class="va">local_index</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">index</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="LargeData_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>The <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans()</a></code> algorithm that determines subsets uses a
random start, so setting a seed is required to reproduce results
exactly. Model results should not change substantially between random
starts, however. A fixed subset list can be provided to
<code>local</code> so that subset assignment does not change across
model fits. For more on the <code>local</code> argument, see the
<code><a href="../reference/ssn_lm.html">ssn_lm()</a></code> documentation by running <code>?ssn_lm()</code> or
by visiting <a href="https://usepa.github.io/SSN2/reference/ssn_lm.html">this
link</a>.</p>
<p>Now we use the model fit via spatial indexing to make local
neighborhood predictions. In <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> (and
<code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>), the default value for the local neighborhood
<code>size</code> is 4,000, which is larger than <span class="math inline">\(n = 549\)</span>. However, if we set
<code>size</code> to be 250 (instead of 4,000), we can illustrate some
concepts behind local neighborhood prediction in <code>SSN2</code> that
will be useful when observed data sets are larger and <code>size</code>
<span class="math inline">\(&lt;&lt; n\)</span>.</p>
<p>When setting <code>size</code> to 250, the 250 observations sharing
the highest average covariance with the prediction locations are used as
the local neighborhood subset. We compute the covariance matrix between
the prediction and observed locations by running:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_pred_by_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/covmatrix.html" class="external-link">covmatrix</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span>, newdata <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cov_pred_by_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 300 549</span></span></code></pre></div>
<p>We then find the average covariance between the prediction and
observed locations by running:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">avg_cov_with_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">cov_pred_by_obs</span><span class="op">)</span></span></code></pre></div>
<p>We then order these (largest covariance first), find indices
corresponding to the 250 observations with the highest average
covariance, and create a vector called <code>Include</code>, that has
the value <code>"Yes"</code> if the observation is used in the local
neighborhood subset and the value <code>"No"</code> if it is not:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">avg_cov_with_obs</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">largest_300</span> <span class="op">&lt;-</span> <span class="va">cov_order</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">250</span><span class="op">]</span></span>
<span><span class="va">row_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">Include</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">row_number</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">largest_300</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize these designations by running:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Include</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="LargeData_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The 250 observations with the highest average covariance
(<code>Include = "Yes"</code>) tend to be nearby several prediction
points, while the remaining observations (<code>Include = "No"</code>)
are often on the basin’s boundaries.</p>
<p>Using a local neighborhood <code>size</code> of 250, we then augment
the prediction data with predictions by running:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_ssn_mod_bd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">ssn_mod_bd</span>,</span>
<span>  newdata <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"prediction"</span>,</span>
<span>  local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Unsurprisingly, the local neighborhood approach may not perform well
when prediction locations are far away from any observed locations in
the local neighborhood, which can happen when <code>size</code> <span class="math inline">\(&lt;&lt; n\)</span>. In this case, one can
separate prediction locations into smaller geographically based subsets
and stored as separate prediction data sets in
<code>ssn.object$preds</code>. The local neighborhood is recomputed for
each subset separately based on the <code>size</code> observations most
correlated (on average) with the prediction locations from that
subset.</p>
</div>
<div class="section level2">
<h2 id="comparing-the-approaches">Comparing the Approaches<a class="anchor" aria-label="anchor" href="#comparing-the-approaches"></a>
</h2>
<p>So far we fit the same model using the 1) standard and 2) large data
set (i.e., spatial indexing) approaches and made predictions at new
locations using the 1) standard and 2) large data set (i.e., local
neighborhood prediction) approaches. How do the results from the
distinct approaches compare?</p>
<div class="section level3">
<h3 id="model-summaries">Model Summaries<a class="anchor" aria-label="anchor" href="#model-summaries"></a>
</h3>
<p>The two approaches have very similar summary output, particularly in
the fixed effects coefficients table (which is often of primary
ecological interest):</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Rich ~ ELEV_DEM, ssn.object = bugs, tailup_type = "exponential", </span></span>
<span><span class="co">#&gt;     taildown_type = "exponential", additive = "afvArea")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -36.387  -5.289   1.693   7.139  22.507 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 44.358544   2.216618  20.012  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ELEV_DEM    -0.004651   0.001357  -3.428 0.000609 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pseudo R-squared: 0.02134</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;                 Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;     tailup exponential  de (parsill)  5.281e+00</span></span>
<span><span class="co">#&gt;     tailup exponential         range  1.008e+06</span></span>
<span><span class="co">#&gt;   taildown exponential  de (parsill)  2.395e+01</span></span>
<span><span class="co">#&gt;   taildown exponential         range  4.582e+04</span></span>
<span><span class="co">#&gt;                 nugget        nugget  6.016e+01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; ssn_lm(formula = Rich ~ ELEV_DEM, ssn.object = bugs, tailup_type = "exponential", </span></span>
<span><span class="co">#&gt;     taildown_type = "exponential", additive = "afvArea", local = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -36.608  -5.439   1.572   6.845  22.290 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (fixed):</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) 44.198118   2.018556  21.896  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ELEV_DEM    -0.004428   0.001255  -3.528 0.000418 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pseudo R-squared: 0.02201</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients (covariance):</span></span>
<span><span class="co">#&gt;                 Effect     Parameter   Estimate</span></span>
<span><span class="co">#&gt;     tailup exponential  de (parsill)  1.417e+00</span></span>
<span><span class="co">#&gt;     tailup exponential         range  9.174e+05</span></span>
<span><span class="co">#&gt;   taildown exponential  de (parsill)  2.496e+01</span></span>
<span><span class="co">#&gt;   taildown exponential         range  2.834e+04</span></span>
<span><span class="co">#&gt;                 nugget        nugget  5.888e+01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="leave-one-out-cross-validation">Leave-One-Out Cross Validation<a class="anchor" aria-label="anchor" href="#leave-one-out-cross-validation"></a>
</h3>
<p>The two approaches have very similar leave-one-out cross validation
output:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 10</span></span></span>
<span><span class="co">#&gt;     bias std.bias  MSPE RMSPE std.MSPE   RAV  cor2 cover.80 cover.90 cover.95</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.038<span style="text-decoration: underline;">2</span>  0.009<span style="text-decoration: underline;">59</span>  75.3  8.68    0.984  8.74 0.157    0.825    0.903    0.953</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 10</span></span></span>
<span><span class="co">#&gt;     bias std.bias  MSPE RMSPE std.MSPE   RAV  cor2 cover.80 cover.90 cover.95</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.034<span style="text-decoration: underline;">0</span>  0.008<span style="text-decoration: underline;">60</span>  75.4  8.69     1.01  8.63 0.155    0.821    0.903    0.953</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h3>
<p>The predictions from the two approaches are very similar. We see the
first few rows of the augmented prediction data by running:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aug_ssn_mod</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ELEV_DEM"</span>, <span class="st">".fitted"</span>, <span class="st">".lower"</span>, <span class="st">".upper"</span>, <span class="st">"pid"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1752503 ymin: 2662140 xmax: -1682209 ymax: 2722702</span></span>
<span><span class="co">#&gt; Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   ELEV_DEM .fitted .lower .upper   pid           geometry</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      707    41.0   23.2   58.7   550 (-1682209 2720031)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     <span style="text-decoration: underline;">1</span>266    38.4   19.9   56.9   709 (-1709066 2717244)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     <span style="text-decoration: underline;">1</span>262    39.8   21.5   58.1   868 (-1752503 2692751)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      888    38.8   20.5   57.0  <span style="text-decoration: underline;">1</span>141 (-1698700 2662140)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     <span style="text-decoration: underline;">1</span>303    39.9   21.7   58.1  <span style="text-decoration: underline;">1</span>365 (-1750463 2674396)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     <span style="text-decoration: underline;">1</span>078    40.0   22.4   57.6  <span style="text-decoration: underline;">1</span>613 (-1685728 2722702)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aug_ssn_mod_bd</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ELEV_DEM"</span>, <span class="st">".fitted"</span>, <span class="st">".lower"</span>, <span class="st">".upper"</span>, <span class="st">"pid"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -1752503 ymin: 2662140 xmax: -1682209 ymax: 2722702</span></span>
<span><span class="co">#&gt; Projected CRS: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   ELEV_DEM .fitted .lower .upper   pid           geometry</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      707    41.4   23.5   59.2   550 (-1682209 2720031)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     <span style="text-decoration: underline;">1</span>266    38.7   20.5   56.8   709 (-1709066 2717244)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     <span style="text-decoration: underline;">1</span>262    39.6   21.6   57.7   868 (-1752503 2692751)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      888    40.4   22.2   58.6  <span style="text-decoration: underline;">1</span>141 (-1698700 2662140)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     <span style="text-decoration: underline;">1</span>303    39.8   21.8   57.8  <span style="text-decoration: underline;">1</span>365 (-1750463 2674396)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     <span style="text-decoration: underline;">1</span>078    40.7   23.2   58.1  <span style="text-decoration: underline;">1</span>613 (-1685728 2722702)</span></span></code></pre></div>
<p>We visualize the predictions from the standard approach and local
neighborhood (LNBH) approach by running:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_ssn_mod</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"Standard"</span></span>
<span><span class="va">aug_ssn_mod_bd</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"LNBH"</span></span>
<span><span class="va">augs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">aug_ssn_mod</span>, <span class="va">aug_ssn_mod_bd</span><span class="op">)</span></span>
<span><span class="va">augs</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">augs</span><span class="op">$</span><span class="va">type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Standard"</span>, <span class="st">"LNBH"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">augs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">augs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">117</span>, <span class="fl">114</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="LargeData_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>We predict the average in the entire domain (i.e., block prediction)
by running:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">ssn_mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  block <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"prediction"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;        fit      lwr      upr</span></span>
<span><span class="co">#&gt; 1 38.44282 36.94272 39.94292</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">ssn_mod_bd</span>,</span>
<span>  newdata <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  block <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"prediction"</span>,</span>
<span>  local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;        fit      lwr      upr</span></span>
<span><span class="co">#&gt; 1 38.63474 37.08141 40.18807</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="closing-thoughts">Closing Thoughts<a class="anchor" aria-label="anchor" href="#closing-thoughts"></a>
</h2>
<p>The standard and large data set (i.e., spatial indexing; local
neighborhood prediction) approaches used here yielded very similar
results. For data with larger observed sample sizes (<span class="math inline">\(n &gt; \approx 5,000\)</span>), the spatial
indexing and local neighborhood prediction approaches are significantly
more computationally efficient than their standard approach counterparts
(in fact, the standard approaches won’t be feasible for very large data
sets). See <span class="citation">Ver Hoef et al. (2023)</span> and
<span class="citation">Dumelle et al. (2024)</span> for a more thorough
look at spatial indexing and local neighborhood prediction.</p>
</div>
<div class="section level2">
<h2 id="why-the-computational-burden">Why the Computational Burden?<a class="anchor" aria-label="anchor" href="#why-the-computational-burden"></a>
</h2>
<p>The main computational burden associated with estimation and
prediction is computing products that involve the inverse covariance
matrix. Inversion scales cubically with the sample size. This means that
if the sample size doubles, the inversion computational cost increases
eight-fold! For estimating parameters, this inversion is required during
each step of the optimization algorithm (generally, dozens of steps are
required for convergence of the optimization algorithm). For prediction,
this inversion is only required once. So, for data sets having a few
thousand observations, one can use spatial indexing to fit the model but
then use standard prediction instead of local neighborhood prediction
(as the inverse covariance matrix products are only required once).</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="r-code-appendix">R Code Appendix<a class="anchor" aria-label="anchor" href="#r-code-appendix"></a>
</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"#&gt;"</span>,</span>
<span>  message <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  warning <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usepa.github.io/SSN2/">SSN2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">bugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_import.html">ssn_import</a></span><span class="op">(</span><span class="st">"bugs.ssn"</span>, predpts <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="va">bugs</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Rich</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ssn_create_distmat.html">ssn_create_distmat</a></span><span class="op">(</span><span class="va">bugs</span>, predpts <span class="op">=</span> <span class="st">"pred"</span>, among_predpts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">standard_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Rich</span> <span class="op">~</span> <span class="va">ELEV_DEM</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">bugs</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">standard_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">standard_start</span></span>
<span><span class="va">standard_time</span></span>
<span><span class="va">aug_ssn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">ssn_mod</span>, newdata <span class="op">=</span> <span class="st">"pred"</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ssn_create_bigdist.html">ssn_create_bigdist</a></span><span class="op">(</span><span class="va">bugs</span>, predpts <span class="op">=</span> <span class="st">"pred"</span>, among_predpts <span class="op">=</span> <span class="cn">TRUE</span>, no_cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">bd_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ssn_mod_bd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssn_lm.html">ssn_lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Rich</span> <span class="op">~</span> <span class="va">ELEV_DEM</span>,</span>
<span>  ssn.object <span class="op">=</span> <span class="va">bugs</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  additive <span class="op">=</span> <span class="st">"afvArea"</span>,</span>
<span>  local <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bd_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">bd_start</span></span>
<span><span class="va">bd_time</span></span>
<span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span><span class="op">$</span><span class="va">local_index</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">index</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">cov_pred_by_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://usepa.github.io/spmodel/reference/covmatrix.html" class="external-link">covmatrix</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span>, newdata <span class="op">=</span> <span class="st">"pred"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cov_pred_by_obs</span><span class="op">)</span></span>
<span><span class="va">avg_cov_with_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">cov_pred_by_obs</span><span class="op">)</span></span>
<span><span class="va">cov_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">avg_cov_with_obs</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">largest_300</span> <span class="op">&lt;-</span> <span class="va">cov_order</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">250</span><span class="op">]</span></span>
<span><span class="va">row_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bugs</span><span class="op">$</span><span class="va">obs</span><span class="op">$</span><span class="va">Include</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">row_number</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">largest_300</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">preds</span><span class="op">$</span><span class="va">pred</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Include</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">aug_ssn_mod_bd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">ssn_mod_bd</span>,</span>
<span>  newdata <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"prediction"</span>,</span>
<span>  local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://usepa.github.io/spmodel/reference/loocv.html" class="external-link">loocv</a></span><span class="op">(</span><span class="va">ssn_mod_bd</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aug_ssn_mod</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ELEV_DEM"</span>, <span class="st">".fitted"</span>, <span class="st">".lower"</span>, <span class="st">".upper"</span>, <span class="st">"pid"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aug_ssn_mod_bd</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ELEV_DEM"</span>, <span class="st">".fitted"</span>, <span class="st">".lower"</span>, <span class="st">".upper"</span>, <span class="st">"pid"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">aug_ssn_mod</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"Standard"</span></span>
<span><span class="va">aug_ssn_mod_bd</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"LNBH"</span></span>
<span><span class="va">augs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">aug_ssn_mod</span>, <span class="va">aug_ssn_mod_bd</span><span class="op">)</span></span>
<span><span class="va">augs</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">augs</span><span class="op">$</span><span class="va">type</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Standard"</span>, <span class="st">"LNBH"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">augs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bugs</span><span class="op">$</span><span class="va">edges</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">augs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">117</span>, <span class="fl">114</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">ssn_mod</span>,</span>
<span>  newdata <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  block <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"prediction"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">ssn_mod_bd</span>,</span>
<span>  newdata <span class="op">=</span> <span class="st">"pred"</span>,</span>
<span>  block <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"prediction"</span>,</span>
<span>  local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-dumelle2024modeling" class="csl-entry">
Dumelle, Michael, Jay M Ver Hoef, Amalia Handler, Ryan A Hill, Matt
Higham, and Anthony R Olsen. 2024. <span>“Modeling Lake Conductivity in
the Contiguous United States Using Spatial Indexing for Big Spatial
Data.”</span> <em>Spatial Statistics</em> 59: 100808.
</div>
<div id="ref-ver2023indexing" class="csl-entry">
Ver Hoef, Jay M, Michael Dumelle, Matt Higham, Erin E Peterson, and
Daniel J Isaak. 2023. <span>“Indexing and Partitioning the Spatial
Linear Model for Large Data Sets.”</span> <em>Plos One</em> 18 (11):
e0291906.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael Dumelle, Jay M. Ver Hoef, Erin Peterson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
