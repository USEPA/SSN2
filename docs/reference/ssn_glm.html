<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function works on spatial stream network objects to fit
generalized linear models with spatially autocorrelated errors using likelihood methods, allowing for
non-spatial random effects, anisotropy, partition factors, big data methods, and more.
The spatial formulation is described in Ver Hoef and Peterson (2010)
and Peterson and Ver Hoef (2010)."><title>Fitting Generalized Linear Models for Spatial Stream Networks — ssn_glm • SSN2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Generalized Linear Models for Spatial Stream Networks — ssn_glm"><meta property="og:description" content="This function works on spatial stream network objects to fit
generalized linear models with spatially autocorrelated errors using likelihood methods, allowing for
non-spatial random effects, anisotropy, partition factors, big data methods, and more.
The spatial formulation is described in Ver Hoef and Peterson (2010)
and Peterson and Ver Hoef (2010)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SSN2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">An Introduction to Spatial Stream Network Modeling in R Using SSN2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/SSN2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fitting Generalized Linear Models for Spatial Stream Networks</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/SSN2/blob/HEAD/R/ssn_glm.R" class="external-link"><code>R/ssn_glm.R</code></a></small>
      <div class="d-none name"><code>ssn_glm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function works on spatial stream network objects to fit
generalized linear models with spatially autocorrelated errors using likelihood methods, allowing for
non-spatial random effects, anisotropy, partition factors, big data methods, and more.
The spatial formulation is described in Ver Hoef and Peterson (2010)
and Peterson and Ver Hoef (2010).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ssn_glm</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">ssn.object</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"Gaussian"</span>,</span>
<span>  tailup_type <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  taildown_type <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  euclid_type <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  nugget_type <span class="op">=</span> <span class="st">"nugget"</span>,</span>
<span>  <span class="va">tailup_initial</span>,</span>
<span>  <span class="va">taildown_initial</span>,</span>
<span>  <span class="va">euclid_initial</span>,</span>
<span>  <span class="va">nugget_initial</span>,</span>
<span>  <span class="va">dispersion_initial</span>,</span>
<span>  <span class="va">additive</span>,</span>
<span>  estmethod <span class="op">=</span> <span class="st">"reml"</span>,</span>
<span>  anisotropy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">random</span>,</span>
<span>  <span class="va">randcov_initial</span>,</span>
<span>  <span class="va">partition_factor</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>A two-sided linear formula describing the fixed effect structure
of the model, with the response to the left of the <code>~</code> operator and
the terms on the right, separated by <code>+</code> operators.</p></dd>


<dt>ssn.object</dt>
<dd><p>A spatial stream network object with class <code>SSN</code>.</p></dd>


<dt>family</dt>
<dd><p>The generalized linear model family for use with <code>ssn_glm()</code>.
Available options include <code>"Gaussian"</code>, <code>"poisson"</code>,
<code>"nbinomial"</code> (negative binomial), <code>"binomial"</code>, <code>"beta"</code>,
<code>"Gamma"</code>, and <code>"invgauss"</code>. When <code>family</code>
is <code>"Gaussian"</code>, arguments are passed to and evaluated by <code><a href="ssn_lm.html">ssn_lm()</a></code>.
The default is <code>"Gaussian"</code>. Can be quoted or unquoted.</p></dd>


<dt>tailup_type</dt>
<dd><p>The tailup covariance function type. Available options
include <code>"linear"</code>, <code>"spherical"</code>, <code>"exponential"</code>,
<code>"mariah"</code>, <code>"epa"</code>, and <code>"none"</code>. Parameterizations are
described in Details.</p></dd>


<dt>taildown_type</dt>
<dd><p>The taildown covariance function type. Available options
include <code>"linear"</code>, <code>"spherical"</code>, <code>"exponential"</code>,
<code>"mariah"</code>, <code>"epa"</code>, and <code>"none"</code>. Parameterizations are
described in Details.</p></dd>


<dt>euclid_type</dt>
<dd><p>The euclidean covariance function type. Available options
include <code>"spherical"</code>, <code>"exponential"</code>, <code>"gaussian"</code>,
<code>"cosine"</code>, <code>"cubic"</code>, <code>"pentaspherical"</code>, <code>"wave"</code>,
<code>"jbessel"</code>, <code>"gravity"</code>, <code>"rquad"</code>, <code>"magnetic"</code>, and
<code>"none"</code>. Parameterizations are
described in Details.</p></dd>


<dt>nugget_type</dt>
<dd><p>The nugget covariance function type. Available options
include <code>"nugget"</code> or <code>"none"</code>. Parameterizations are
described in Details.</p></dd>


<dt>tailup_initial</dt>
<dd><p>An object from <code><a href="ssn_initial.html">tailup_initial()</a></code> specifying initial and/or
known values for the tailup covariance parameters.</p></dd>


<dt>taildown_initial</dt>
<dd><p>An object from <code><a href="ssn_initial.html">taildown_initial()</a></code> specifying initial and/or
known values for the taildown covariance parameters.</p></dd>


<dt>euclid_initial</dt>
<dd><p>An object from <code><a href="ssn_initial.html">euclid_initial()</a></code> specifying initial and/or
known values for the euclidean covariance parameters.</p></dd>


<dt>nugget_initial</dt>
<dd><p>An object from <code><a href="ssn_initial.html">nugget_initial()</a></code> specifying initial and/or
known values for the nugget covariance parameters.</p></dd>


<dt>dispersion_initial</dt>
<dd><p>An object from <code><a href="https://usepa.github.io/spmodel/reference/dispersion_initial.html" class="external-link">dispersion_initial()</a></code> specifying initial and/or
known values for the tailup covariance parameters.</p></dd>


<dt>additive</dt>
<dd><p>The name of the variable in <code>ssn.object</code> that is used
to define spatial weights. Can be quoted or unquoted. For the tailup covariance functions, these additive
weights are used for branching. Technical details that describe the role
of the additive variable in the tailup covariance function are available
in Ver Hoef and Peterson (2010).</p></dd>


<dt>estmethod</dt>
<dd><p>The estimation method. Available options include
<code>"reml"</code> for restricted maximum likelihood and <code>"ml"</code> for maximum
likelihood. The default is <code>"reml"</code>.</p></dd>


<dt>anisotropy</dt>
<dd><p>A logical indicating whether (geometric) anisotropy should
be modeled. Not required if <code>spcov_initial</code> is provided with 1) <code>rotate</code>
assumed unknown or assumed known and non-zero or 2) <code>scale</code> assumed unknown
or assumed known and less than one. When <code>anisotropy</code> is <code>TRUE</code>,
computational times can significantly increase. The default is <code>FALSE</code>.</p></dd>


<dt>random</dt>
<dd><p>A one-sided linear formula describing the random effect structure
of the model. Terms are specified to the right of the <code>~ operator</code>.
Each term has the structure <code>x1 + ... + xn | g1/.../gm</code>, where <code>x1 + ... + xn</code>
specifies the model for the random effects and <code>g1/.../gm</code> is the grouping
structure. Separate terms are separated by <code>+</code> and must generally
be wrapped in parentheses. Random intercepts are added to each model
implicitly when at least  one other variable is defined.
If a random intercept is not desired, this must be explicitly
defined (e.g., <code>x1 + ... + xn - 1 | g1/.../gm</code>). If only a random intercept
is desired for a grouping structure, the random intercept must be specified
as <code>1 | g1/.../gm</code>. Note that <code>g1/.../gm</code> is shorthand for <code>(1 | g1/.../gm)</code>.
If only random intercepts are desired and the shorthand notation is used,
parentheses can be omitted.</p></dd>


<dt>randcov_initial</dt>
<dd><p>An optional object specifying initial and/or
known values for the random effect variances. See <code><a href="https://usepa.github.io/spmodel/reference/randcov_initial.html" class="external-link">spmodel::randcov_initial()</a></code>.</p></dd>


<dt>partition_factor</dt>
<dd><p>A one-sided linear formula with a single term
specifying the partition factor.  The partition factor assumes observations
from different levels of the partition factor are uncorrelated.</p></dd>


<dt>...</dt>
<dd><p>Other arguments to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with many elements that store information about
the fitted model object and has class <code>ssn_glm</code>. Many generic functions that
summarize model fit are available for <code>ssn_glm</code> objects, including
<code>AIC</code>, <code>AICc</code>, <code>anova</code>, <code>augment</code>, <code>coef</code>,
<code>cooks.distance</code>, <code>covmatrix</code>, <code>deviance</code>, <code>fitted</code>, <code>formula</code>,
<code>glance</code>, <code>glances</code>, <code>hatvalues</code>, <code>influence</code>,
<code>labels</code>, <code>logLik</code>, <code>loocv</code>, <code>model.frame</code>, <code>model.matrix</code>,
<code>plot</code>, <code>predict</code>, <code>print</code>, <code>pseudoR2</code>, <code>summary</code>,
<code>terms</code>, <code>tidy</code>, <code>update</code>, <code>varcomp</code>, and <code>vcov</code>.</p>


<p>This fitted model list contains the following elements:</p><ul><li><p><code>additive</code>: The name of the additive function value column.</p></li>
<li><p><code>anisotropy</code>: Whether euclidean anisotropy was modeled.</p></li>
<li><p><code>call</code>: The function call.</p></li>
<li><p><code>coefficients</code>: Model coefficients.</p></li>
<li><p><code>contrasts</code>: Any user-supplied contrasts.</p></li>
<li><p><code>cooks_distance</code>: Cook's distance values.</p></li>
<li><p><code>crs</code>: The geographic coordinate reference system.</p></li>
<li><p><code>deviance</code>: The model deviance.</p></li>
<li><p><code>diagtol</code>: A tolerance value that may be added to the diagonal
of  ovariance matrices to encourage decomposition stability.</p></li>
<li><p><code>estmethod</code>: The estimation method.</p></li>
<li><p><code>euclid_max</code>: The maximum euclidean distance.</p></li>
<li><p><code>family</code>: The generalized linear model family</p></li>
<li><p><code>fitted</code>: Fitted values.</p></li>
<li><p><code>formula</code>: The model formula.</p></li>
<li><p><code>hatvalues</code>: The hat (leverage) values.</p></li>
<li><p><code>is_known</code>: An object that identifies which parameters are known.</p></li>
<li><p><code>local_index</code>: An index identifier used internally for sorting.</p></li>
<li><p><code>missing_index</code>: Which rows in the "obs" object had missing responses.</p></li>
<li><p><code>n</code>: The sample size.</p></li>
<li><p><code>npar</code>: The number of estimated covariance parameters.</p></li>
<li><p><code>observed_index</code>: Which rows in the "obs" object had observed responses.</p></li>
<li><p><code>optim</code>: The optimization output.</p></li>
<li><p><code>p</code>: The number of fixed effects.</p></li>
<li><p><code>partition_factor</code>: The partition factor formula.</p></li>
<li><p><code>pseudoR2</code>: The pseudo R-squared.</p></li>
<li><p><code>random</code>: The random effect formula.</p></li>
<li><p><code>residuals</code>: The residuals.</p></li>
<li><p><code>sf_column_name</code>: The name of the geometry columns <code>ssn.object</code></p></li>
<li><p><code>size</code>: The size of the binomial trials if relevant.</p></li>
<li><p><code>ssn.object</code>: An updated <code>ssn.object</code>.</p></li>
<li><p><code>tail_max</code>: The maximum stream distance.</p></li>
<li><p><code>terms</code>: The model terms.</p></li>
<li><p><code>vcov</code>: Variance-covariance matrices</p></li>
<li><p><code>xlevels</code>: The levels of factors in the model matrix.</p></li>
<li><p><code>y</code>: The response.</p></li>
</ul><p>These list elements are meant to be used with various generic functions
(<code>e.g., residuals()</code> that operate on the model object.
While possible to access elements of the fitted model list directly, we strongly
advise against doing so when there is a generic available to return the element
of interest. For example, we strongly recommend using <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code> to
obtain model residuals instead of accessing the fitted model list directly via
<code>object$residuals</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The generalized linear model for spatial stream networks can be written as
\(g(\mu) = \eta = X \beta + zu + zd + ze + n\), where \(\mu\) is the expectation
of the response given the random errors, \(y\), \(g()\) is a function that links the mean
and \(\eta\) (and is called a link function), <code>X</code> is the fixed effects design
matrix, \(\beta\) are the fixed effects, \(zu\) is tailup random error,
\(zd\) is taildown random error, and \(ze\) is Euclidean random error,
and \(n\) is nugget random error.</p>
<p>There are six generalized linear model
families available: <code>poisson</code> assumes \(y\) is a Poisson random variable
<code>nbinomial</code> assumes \(y\) is a negative binomial random
variable, <code>binomial</code> assumes \(y\) is a binomial random variable,
<code>beta</code> assumes \(y\) is a beta random variable,
<code>Gamma</code> assumes \(y\) is a gamma random
variable, and <code>inverse.gaussian</code> assumes \(y\) is an inverse Gaussian
random variable.</p>
<p>The supports for \(y\) for each family are given below:</p><ul><li><p>family: support of \(y\)</p></li>
<li><p>Gaussian: \(-\infty &lt; y &lt; \infty\)</p></li>
<li><p>poisson: \(0 \le y\); \(y\) an integer</p></li>
<li><p>nbinomial: \(0 \le y\); \(y\) an integer</p></li>
<li><p>binomial: \(0 \le y\); \(y\) an integer</p></li>
<li><p>beta: \(0 &lt; y &lt; 1\)</p></li>
<li><p>Gamma: \(0 &lt; y\)</p></li>
<li><p>inverse.gaussian: \(0 &lt; y\)</p></li>
</ul><p>The generalized linear model families
and the parameterizations of their link functions are given
below:</p><ul><li><p>family: link function</p></li>
<li><p>Gaussian: \(g(\mu) = \eta\) (identity link)</p></li>
<li><p>poisson: \(g(\mu) = log(\eta)\) (log link)</p></li>
<li><p>nbinomial: \(g(\mu) = log(\eta)\) (log link)</p></li>
<li><p>binomial: \(g(\mu) = log(\eta / (1 - \eta))\) (logit link)</p></li>
<li><p>beta: \(g(\mu) = log(\eta / (1 - \eta))\) (logit link)</p></li>
<li><p>Gamma: \(g(\mu) = log(\eta)\) (log link)</p></li>
<li><p>inverse.gaussian: \(g(\mu) = log(\eta)\) (log link)</p></li>
</ul><p>The variance function of an individual \(y\) (given \(\mu\))
for each generalized linear model family is given below:</p><ul><li><p>family: \(Var(y)\)</p></li>
<li><p>Gaussian: \(\sigma^2\)</p></li>
<li><p>poisson: \(\mu \phi\)</p></li>
<li><p>nbinomial: \(\mu + \mu^2 / \phi\)</p></li>
<li><p>binomial: \(n \mu (1 - \mu) \phi\)</p></li>
<li><p>beta: \(\mu (1 - \mu) / (1 + \phi)\)</p></li>
<li><p>Gamma: \(\mu^2 / \phi\)</p></li>
<li><p>inverse.gaussian: \(\mu^2 / \phi\)</p></li>
</ul><p>The parameter \(\phi\) is a dispersion parameter that influences \(Var(y)\).
For the <code>poisson</code> and <code>binomial</code> families, \(\phi\) is always
one. Note that this inverse Gaussian parameterization is different than a
standard inverse Gaussian parameterization, which has variance \(\mu^3 / \lambda\).
Setting \(\phi = \lambda / \mu\) yields our parameterization, which is
preferred for computational stability. Also note that the dispersion parameter
is often defined in the literature as \(V(\mu) \phi\), where \(V(\mu)\) is the variance
function of the mean. We do not use this parameterization, which is important
to recognize while interpreting dispersion estimates.
For more on generalized linear model constructions, see McCullagh and
Nelder (1989).</p>
<p>In the generalized linear model context, the tailup, taildown, Euclidean, and
nugget covariance affect the modeled mean of an observation (conditional on
these effects). On the link scale, the tailup random errors capture spatial
covariance moving downstream (and depend on downstream distance), the taildown
random errors capture spatial covariance moving upstream (and depend on upstream)
distance, the Euclidean random errors capture spatial covariance that depends on
Euclidean distance, and the nugget random errors captures variability
independent of spatial locations. \(\eta\) is modeled using a
spatial covariance function expressed as
\(de(zu) * R(zu) + de(zd) * R(zd) + de(ze) * R(ze) + nugget * I\).
\(de(zu)\), \(de(zu)\), and \(de(zd)\) represent the tailup, taildown, and Euclidean
variances, respectively. \(R(zu)\), \(R(zd)\), and \(R(ze)\) represent the tailup,
taildown, and Euclidean correlation matrices, respectively. Each correlation
matrix depends on a range parameter that controls the distance-decay behavior
of the correlation. \(nugget\) represents the nugget variance and
\(I\) represents an identity matrix.</p>
<p><code>tailup_type</code> Details: Let \(D\) be a matrix of hydrologic distances,
\(W\) be a diagonal matrix of weights from <code>additive</code>, \(r = D / range\),
and \(I\) be
an identity matrix. Then parametric forms for flow-connected
elements of \(R(zu)\) are given below:</p><ul><li><p>linear: \((1 - r) * (r &lt;= 1) * W\)</p></li>
<li><p>spherical: \((1 - 1.5r + 0.5r^3) * (r &lt;= 1) * W\)</p></li>
<li><p>exponential: \(exp(-r) * W\)</p></li>
<li><p>mariah: \(log(90r + 1) / 90r * (D &gt; 0) + 1 * (D = 0) * W\)</p></li>
<li><p>epa: \((D - range)^2 * F * (r &lt;= 1) * W / 16range^5\)</p></li>
<li><p>none: \(I\) * W</p></li>
</ul><p>Details describing the <code>F</code> matrix in the <code>epa</code> covariance are given in Garreta et al. (2010).
Flow-unconnected elements of \(R(zu)\) are assumed uncorrelated.
Observations on different networks are also assumed uncorrelated.</p>
<p><code>taildown_type</code> Details: Let \(D\) be a matrix of hydrologic distances,
\(r = D / range\),
and \(I\) be an identity matrix. Then parametric forms for flow-connected
elements of \(R(zd)\) are given below:</p><ul><li><p>linear: \((1 - r) * (r &lt;= 1)\)</p></li>
<li><p>spherical: \((1 - 1.5r + 0.5r^3) * (r &lt;= 1)\)</p></li>
<li><p>exponential: \(exp(-r)\)</p></li>
<li><p>mariah: \(log(90r + 1) / 90r * (D &gt; 0) + 1 * (D = 0)\)</p></li>
<li><p>epa: \((D - range)^2 * F1 * (r &lt;= 1) / 16range^5\)</p></li>
<li><p>none: \(I\)</p></li>
</ul><p>Now let \(A\) be a matrix that contains the shorter of the two distances
between two sites and the common downstream junction, \(r1 = A / range\),
\(B\) be a matrix that contains the longer of the two distances between two sites and the
common downstream junction, \(r2 = B / range\),  and \(I\) be an identity matrix.
Then parametric forms for flow-unconnected elements of \(R(zd)\) are given below:</p><ul><li><p>linear: \((1 - r2) * (r2 &lt;= 1)\)</p></li>
<li><p>spherical: \((1 - 1.5r1 + 0.5r2) * (1 - r2)^2 * (r2 &lt;= 1)\)</p></li>
<li><p>exponential: \(exp(-(r1 + r2))\)</p></li>
<li><p>mariah: \((log(90r1 + 1) - log(90r2 + 1)) / (90r1 - 90r2) * (A =/ B) + (1 / (90r1 + 1)) * (A = B)\)</p></li>
<li><p>epa: \((B - range)^2 * F2 * (r2 &lt;= 1) / 16range^5\)</p></li>
<li><p>none: \(I\)</p></li>
</ul><p>Details describing the <code>F1</code> and <code>F2</code> matrices in the <code>epa</code>
covariance are given in Garreta et al. (2010).
Observations on different networks are assumed uncorrelated.</p>
<p><code>euclid_type</code> Details: Let \(D\) be a matrix of Euclidean distances,
\(r = D / range\), and \(I\) be an identity matrix. Then parametric
forms for elements of \(R(ze)\) are given below:</p><ul><li><p>exponential: \(exp(- r )\)</p></li>
<li><p>spherical: \((1 - 1.5r + 0.5r^3) * (r &lt;= 1)\)</p></li>
<li><p>gaussian: \(exp(- r^2 )\)</p></li>
<li><p>cubic: \((1 - 7r^2 + 8.75r^3 - 3.5r^5 + 0.75r^7) * (r &lt;= 1)\)</p></li>
<li><p>pentaspherical: \((1 - 1.875r + 1.25r^3 - 0.375r^5) * (r &lt;= 1)\)</p></li>
<li><p>cosine: \(cos(r)\)</p></li>
<li><p>wave: \(sin(r) * (h &gt; 0) / r + (h = 0)\)</p></li>
<li><p>jbessel: \(Bj(h * range)\), Bj is Bessel-J function</p></li>
<li><p>gravity: \((1 + r^2)^{-0.5}\)</p></li>
<li><p>rquad: \((1 + r^2)^{-1}\)</p></li>
<li><p>magnetic: \((1 + r^2)^{-1.5}\)</p></li>
<li><p>none: \(I\)</p></li>
</ul><p><code>nugget_type</code> Details: Let \(I\) be an identity matrix and \(0\)
be the zero matrix. Then parametric
forms for elements the nugget variance are given below:</p><ul><li><p>nugget: \(I\)</p></li>
<li><p>none: \(0\)</p></li>
</ul><p>In short, the nugget effect is modeled when <code>nugget_type</code> is <code>"nugget"</code>
and omitted when <code>nugget_type</code> is <code>"none"</code>.</p>
<p><code>estmethod</code> Details: The various estimation methods are</p><ul><li><p><code>reml</code>: Maximize the restricted log-likelihood.</p></li>
<li><p><code>ml</code>: Maximize the log-likelihood.</p></li>
</ul><p><code>anisotropy</code> Details: By default, all Euclidean covariance parameters except <code>rotate</code>
and <code>scale</code> are assumed unknown, requiring estimation. If either <code>rotate</code> or <code>scale</code>
are given initial values other than 0 and 1 (respectively) or are assumed unknown
in <code><a href="ssn_initial.html">euclid_initial()</a></code>, <code>anisotropy</code> is implicitly set to <code>TRUE</code>.
(Geometric) Anisotropy is modeled by transforming a Euclidean covariance function that
decays differently in different directions to one that decays equally in all
directions via rotation and scaling of the original Euclidean coordinates. The rotation is
controlled by the <code>rotate</code> parameter in \([0, \pi]\) radians. The scaling
is controlled by the <code>scale</code> parameter in \([0, 1]\). The anisotropy
correction involves first a rotation of the coordinates clockwise by <code>rotate</code> and then a
scaling of the coordinates' minor axis by the reciprocal of <code>scale</code>. The Euclidean
covariance is then computed using these transformed coordinates.</p>
<p><code>random</code> Details: If random effects are used (the estimation method must be <code>"reml"</code> or
<code>"ml"</code>), the model
can be written as \(g(\mu) = \eta = X \beta + W1\gamma 1 + ... Wj\gamma j + zu + zd + ze + n\),
where each Z is a random effects design matrix and each u is a random effect.</p>
<p><code>partition_factor</code> Details: The partition factor can be represented in matrix form as \(P\), where
elements of \(P\) equal one for observations in the same level of the partition
factor and zero otherwise. The covariance matrix involving only the
spatial and random effects components is then multiplied element-wise
(Hadmard product) by \(P\), yielding the final covariance matrix.</p>
<p>Other Details: Observations with <code>NA</code> response values are removed for model
fitting, but their values can be predicted afterwards by running
<code>predict(object)</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function does not perform any internal scaling. If optimization is not
stable due to large extremely large variances, scale relevant variables
so they have variance 1 before optimization.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Garreta, V., Monestiez, P. and Ver Hoef, J.M. (2010) Spatial modelling and
prediction on river networks: up model, down model, or hybrid?
<em>Environmetrics</em> <b>21(5)</b>, 439--456.</p>
<p>McCullagh P. and Nelder, J. A. (1989) <em>Generalized Linear Models</em>. London: Chapman and Hall.</p>
<p>Peterson, E.E. and Ver Hoef, J.M. (2010) A mixed-model moving-average approach
to geostatistical modeling in stream networks. <em>Ecology</em> <b>91(3)</b>,
644--651.</p>
<p>Ver Hoef, J.M. and Peterson, E.E. (2010) A moving average approach for spatial
statistical models of stream networks (with discussion).
<em>Journal of the American Statistical Association</em> <b>105</b>, 6--18.
DOI: 10.1198/jasa.2009.ap08248.  Rejoinder pgs. 22--24.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Copy the mf04p .ssn data to a local directory and read it into R</span></span></span>
<span class="r-in"><span><span class="co"># When modeling with your .ssn object, you will load it using the relevant</span></span></span>
<span class="r-in"><span><span class="co"># path to the .ssn data on your machine</span></span></span>
<span class="r-in"><span><span class="fu"><a href="copy_lsn_to_temp.html">copy_lsn_to_temp</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/MiddleFork04.ssn"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mf04p</span> <span class="op">&lt;-</span> <span class="fu"><a href="ssn_import.html">ssn_import</a></span><span class="op">(</span><span class="va">temp_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ssn_gmod</span> <span class="op">&lt;-</span> <span class="fu">ssn_glm</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">Summer_mn</span> <span class="op">~</span> <span class="va">ELEV_DEM</span>,</span></span>
<span class="r-in"><span>  ssn.object <span class="op">=</span> <span class="va">mf04p</span>,</span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="st">"Gamma"</span>,</span></span>
<span class="r-in"><span>  tailup_type <span class="op">=</span> <span class="st">"exponential"</span>,</span></span>
<span class="r-in"><span>  additive <span class="op">=</span> <span class="st">"afvArea"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssn_gmod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ssn_glm(formula = Summer_mn ~ ELEV_DEM, ssn.object = mf04p, family = "Gamma", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     tailup_type = "exponential", additive = "afvArea")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        Min         1Q     Median         3Q        Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.613e-03 -1.676e-04 -5.815e-05  2.332e-04  2.579e-03 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients (fixed):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  7.1045136  0.7143946   9.945  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ELEV_DEM    -0.0022450  0.0003582  -6.267 3.68e-10 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Pseudo R-squared: 0.1919</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients (covariance):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Effect     Parameter   Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tailup exponential  de (parsill)  3.226e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   tailup exponential         range  1.676e+05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               nugget        nugget  1.454e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           dispersion    dispersion  1.546e+06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michael Dumelle, Jay M. Ver Hoef, Erin Peterson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

