<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates a collection of (non-symmetric) matrices
containing pairwise downstream hydrologic distances between sites
in an SSN object"><title>Calculate Hydrologic Distances for an SSN object — ssn_create_distmat • SSN2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Hydrologic Distances for an SSN object — ssn_create_distmat"><meta property="og:description" content="Creates a collection of (non-symmetric) matrices
containing pairwise downstream hydrologic distances between sites
in an SSN object"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SSN2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">An Introduction to Spatial Stream Network Modeling in R Using SSN2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USEPA/SSN2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate Hydrologic Distances for an <code>SSN</code> object</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/SSN2/blob/HEAD/R/ssn_create_distmat.R" class="external-link"><code>R/ssn_create_distmat.R</code></a></small>
      <div class="d-none name"><code>ssn_create_distmat.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a collection of (non-symmetric) matrices
containing pairwise downstream hydrologic distances between sites
in an <code>SSN</code> object</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ssn_create_distmat</span><span class="op">(</span></span>
<span>  <span class="va">ssn.object</span>,</span>
<span>  predpts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  among_predpts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  only_predpts <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>ssn.object</dt>
<dd><p>An <code>SSN</code> object</p></dd>


<dt>predpts</dt>
<dd><p>name of prediction points in an <code>SSN</code> object.
When a vector with length greater than one, each name is iterated upon.
Default is NULL.</p></dd>


<dt>overwrite</dt>
<dd><p>Logical. If <code>TRUE</code>, overwrite existing distance
matrices. Defaults to <code>FALSE</code>.</p></dd>


<dt>among_predpts</dt>
<dd><p>Logical. If <code>TRUE</code>, compute the pairwise distances
between the prediction sites. Defaults to <code>FALSE</code>.</p></dd>


<dt>only_predpts</dt>
<dd><p>Logical. If <code>TRUE</code>, only compute distances for
prediction sites. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The <code class="command">ssn_create_distmat</code> function creates a collection
of hierarchical directories in the <code>ssn$path</code> directory,
which store the pairwise distances between sites associated with
the <code>SSN</code> object. See details section for additional information.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A distance matrix that contains the hydrologic distance
between any two sites in <code>SSN</code> object is needed to fit a spatial
statistical model using the tail-up and tail-down autocovariance
functions described in Ver Hoef and Peterson (2010). These models
are implemented in R via <code class="command">ssn_lm</code> and <code class="command">ssn_glm</code> in
the<code>SSN2</code> package. The hydrologic distance information needed to
model the covariance between flow-connected (i.e. water flows
from one location to the other) and flow-unconnected (i.e. water
does not flow from one location to the other, but they reside on
the same network) locations differs. The total hydrologic
distance is a directionless measure; it represents the hydrologic
distance between two sites, ignoring flow direction. The
hydrologic distance from each site to a common downstream stream
junction is used when creating models for flow-unconnected pairs,
which we term downstream hydrologic distance. In contrast, the
total hydrologic distance is used for modeling flow-connected
pairs, which we term total hydrologic distance.</p>
<p>A downstream hydrologic distance matrix provides enough
information to meet the data requirements for both the tail-up and
tail-down models. When two locations are flow-connected, the
downstream hydrologic distance from the upstream location to the
downstream location is greater than zero, but it is zero in the
other direction. When two locations are flow-unconnected the
downstream hydrologic distance will be greater than zero in both
directions. A site's downstream hydrologic distance to itself is
equal to zero. The format of the downstream hydrologic distance
matrix is efficient because distance information needed to fit
both the tail-up and tail-down models is only stored once. As an
example, a matrix containing the total hydrologic distance between
sites is easily calculated by adding the downstream distance
matrix to its transpose.</p>
<p>The downstream hydrologic distances are calculated based on the
binaryIDs and stored as matrices. The matrices are stored in a
directory named ‘distance’, which is created by the
<code class="command">ssn_create_distmat</code> function within the .ssn directory. The distance
directory will always contain at least one directory named
‘obs’, which contains a number of .RData files, one for each
network that has observed sites residing on it. The naming
convention for the files is based on the netID number
(e.g. dist.net1.RData). Each matrix in the ‘obs’ folder
contains the information to form a square matrix, which contains
the downstream hydrologic distance between each pair of observed
sites on the network. Direction is preserved, with columns
representing the FROM site and rows representing the TO site. Row
and column names correspond to the pid attribute for each site.</p>
<p>If the argument <code>predpts</code> is specified in the call to the
function, the downstream hydrologic distances between the observed
and prediction sites will also be computed. A new directory is
created within the distance directory, with the name corresponding
to the names attribute for the preds
(e.g. <code>attributes(ssn.object$preds)$names</code>). A sequence of
.RData files is created within this directory, similar to the
structure for the observed sites, except that two objects are
stored for each network that contains <em>both</em> observed and
prediction sites. The letters <code>a</code> and <code>b</code> are used in
the naming convention to distinguish between the two objects
(e.g. dist.net1.a and dist.net1.b). The matrices that these
objects represent are not necessarily square. In matrices of type
<code>a</code>, rows correspond to observed locations and columns to
prediction locations. In contrast, rows correspond to prediction
locations and columns to observed locations in matrices of type
<code>b</code>. Direction is also preserved, with columns representing
the FROM site and rows representing the TO site in both object
types. Again, row and column names correspond to the pid attribute
for each site.</p>
<p>If <code>among_predpts = TRUE</code>, the downstream
hydrologic distances will also be computed between prediction
sites, for each network. Again these are stored within the distance
directory with the name corresponding to the prediction points
dataset. The naming convention for these prediction to prediction
site distance matrices is the same as the distance matrices stored
in the ‘obs’ directory (e.g. dist.net1.RData). These extra
distance matrices are needed to perform block Kriging using
<code><a href="predict.SSN2.html">predict.ssn_lm</a></code>.</p>
<p>If <code>only_predpts = TRUE</code>, the downstream
hydrologic distances will not be calculated between observed sites
themselves. Pairwise distances will only be calculated for observed
and prediction locations and. Pairwise distances between prediction
locations will also be calculated if <code>among_predpts = TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Copy the MiddleForke04.ssn data to a local temporary directory.</span></span></span>
<span class="r-in"><span><span class="co">## Only needed for this example.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="copy_lsn_to_temp.html">copy_lsn_to_temp</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Import SSN data</span></span></span>
<span class="r-in"><span><span class="va">mf04p</span> <span class="op">&lt;-</span> <span class="fu"><a href="ssn_import.html">ssn_import</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/MiddleFork04.ssn"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  predpts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pred1km.shp"</span>, <span class="st">"Knapp"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create distance matrices for observations and one set of prediction sites</span></span></span>
<span class="r-in"><span><span class="co">## Include hydrologic distance matrices among prediction sites.</span></span></span>
<span class="r-in"><span><span class="fu">ssn_create_distmat</span><span class="op">(</span><span class="va">mf04p</span>,</span></span>
<span class="r-in"><span>  predpts <span class="op">=</span> <span class="st">"pred1km"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  among_predpts <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create distance matrices for an additional set of prediction points.</span></span></span>
<span class="r-in"><span><span class="co">## Distance matrices for observations and pred1km prediction sites are</span></span></span>
<span class="r-in"><span><span class="co">## not recalculated.</span></span></span>
<span class="r-in"><span><span class="fu">ssn_create_distmat</span><span class="op">(</span><span class="va">mf04p</span>,</span></span>
<span class="r-in"><span>  predpts <span class="op">=</span> <span class="st">"Knapp"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  among_predpts <span class="op">=</span> <span class="cn">TRUE</span>, only_predpts <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Michael Dumelle, Jay M. Ver Hoef, Erin Peterson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

